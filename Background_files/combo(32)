YUI.add("hermes-template-fluid-magic-search",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return(s=(n.ifCond||t&&t.ifCond||n.helperMissing).call(t!=null?t:{},t!=null?t.pageType:t,"===","photostream",{name:"ifCond",hash:{},fn:e.program(2,i,0),inverse:e.program(4,i,0),data:i}))!=null?s:""},2:function(e,t,n,r,i){return e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"search.SEARCH_PHOTOSTREAM"},data:i}))},4:function(e,t,n,r,i){return e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"search.SEARCH_FAVORITES"},data:i}))},6:function(e,t,n,r,i){return e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"search.TOGGLE_SEARCH"},data:i}))},8:function(e,t,n,r,i){var s;return'"'+((s=(n.ifCond||t&&t.ifCond||n.helperMissing).call(t!=null?t:{},t!=null?t.pageType:t,"===","photostream",{name:"ifCond",hash:{},fn:e.program(9,i,0),inverse:e.program(11,i,0),data:i}))!=null?s:"")},9:function(e,t,n,r,i){return' data-track="addContextPhotostream"'},11:function(e,t,n,r,i){return' data-track="addContextFaves"'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing;return'<a href="#" class="search-toggle" title="'+((s=(n.isFlipped||t&&t.isFlipped||u).call(o,"enable-new-autosuggest",{name:"isFlipped",hash:{},fn:e.program(1,i,0),inverse:e.program(6,i,0),data:i}))!=null?s:"")+'"'+((s=(n.isFlipped||t&&t.isFlipped||u).call(o,"enable-new-autosuggest",{name:"isFlipped",hash:{},fn:e.program(8,i,0),inverse:e.noop,data:i}))!=null?s:"")+'><span></span></a>\n<input tabindex="-1" class="magic-search" placeholder="'+((s=(n.ifCond||t&&t.ifCond||u).call(o,t!=null?t.pageType:t,"===","photostream",{name:"ifCond",hash:{},fn:e.program(2,i,0),inverse:e.program(4,i,0),data:i}))!=null?s:"")+'" type="text" value=""></input>\n'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-magic-search",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("fluid-magic-search-view",function(e){var t="photostream",n="favorites";e.namespace("Views")[this.name]=e.Base.create("fluid-magic-search-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.selected=e.subnavConfig?e.subnavConfig.selected:"",this},loadState:function(){return this.appContext.getModel("person-models",this.nsid).then(function(e){this.set("personModel",e)}.bind(this))},buildContainer:function(){return this.setContainerWithTemplate("fluid-magic-search",{pageType:this.selected}),this},handleSearchContextRemoval:function(){this.get("container").one(".search-toggle > span").removeClass("active")},activate:function(){var t=this.get("container").one(".magic-search");return t&&(this.registerEventHandler(this.get("container").one(".search-toggle").on("click",this.toggleSearch.bind(this))),this.registerEventHandler(t.on("keyup",this.performSearch.bind(this))),this.registerEventHandler(this.get("container").one(".search-toggle").on(["blur","focus"],this.toggleKeyboardFocusStyling.bind(this)))),this.appContext.flipper.isFlipped("enable-search-pills")&&this.registerEventHandler(e.on("remove-context-in-search-field",this.handleSearchContextRemoval.bind(this))),this},toggleKeyboardFocusStyling:function(e){var t=e.target.ancestor(".fluid-magic-search-view");t&&t.toggleClass("has-keyboard-focus")},toggleSearch:function(t){var n=this.get("container");t.halt(),this.appContext.flipper.isFlipped("enable-search-pills")?(e.fire("add-context-to-search-field",{name:this.get("personModel").getValue("displayname"),id:this.nsid,type:"user",scope:this.selected}),t.target.addClass("active")):n.hasClass("closed")?(n.removeClass("closed"),n.one(".magic-search").focus()):n.addClass("closed")},performSearch:function(r){var i=this.get("container").one(".magic-search").get("value"),s;if(r.keyCode&&r.keyCode!==13)return;r.halt(),this.selected===t?s=new e.SearchUrl({userId:this.nsid,view_all:1},this.appContext,e.SearchUrl.searchTypes.PHOTOS):this.selected===n&&(this.nsid===this.appContext.getViewer().nsid?s=new e.SearchUrl({faves:1,view_all:1},this.appContext,e.SearchUrl.searchTypes.PHOTOS):s=new e.SearchUrl({userId:this.nsid,faves:1,view_all:1},this.appContext,e.SearchUrl.searchTypes.PHOTOS)),s.setSearchTerm(i),this.appContext.flapp.navigate(s.getURL())}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-droparound-view","hermes-template-fluid-magic-search","search-url"],langBundles:["common","search","fluid-toolbar"]});
