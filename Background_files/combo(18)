YUI.add("feed-card-menu-view",function(e,t){e.namespace("Views")[this.name]=e.Base.create("feed-card-menu-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.type=e.menuType,this.card=e.activityCard,this.photoId=this.card.getAttribute("data-photo-id"),this.groupId=this.card.getAttribute("data-group-id"),this.recId=this.card.getAttribute("data-rec-id"),this.feedModel=e.feedModel,this.msnry=e.msnry},loadState:function(){return this},buildContainer:function(){this.setContainerWithTemplate("feed-card-menu",{basic:this.type==="basic",group:this.type==="group",curated:this.type==="curated",rec:this.type==="rec"})},activate:function(){return this.registerEventHandler(this.get("container").delegate("click",this.handleItemClick.bind(this),".feed-card-context-option")),this},handleItemClick:function(e){var t=e.target,n;t.hasClass("turn-off-option")?(this.groupId&&(n={object_id:this.groupId,object_type:1,pref_type:"GroupBatch",pref_val:0},this.feedModel.insertUserPrefsRemote(n)),this.fire("turnOff",{card:this.card})):t.hasClass("hide-rec-option")?(this.fire("hideRec",e),this.feedModel.updateRecommendedFeedbackRemote(this.photoId,this.recId)):t.hasClass("report-option"),this.fire("actionClick",e)}},{ATTRS:{}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-feed-card-menu"],langBundles:["common","feed"]});
YUI.add("hermes-template-fave",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return"is-faved"},3:function(e,t,n,r,i){return"can-not-fave"},5:function(e,t,n,r,i){var s;return e.escapeExpression((n.formatNumber||t&&t.formatNumber||n.helperMissing).call(t!=null?t:{},(s=t!=null?t.photo:t)!=null?s.faveCount:s,{name:"formatNumber",hash:{},data:i}))},7:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},(s=t!=null?t.photo:t)!=null?s.faveCount:s,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.noop,data:i}))!=null?s:""},8:function(e,t,n,r,i){var s;return e.escapeExpression((n.friendlyNumber||t&&t.friendlyNumber||n.helperMissing).call(t!=null?t:{},(s=t!=null?t.photo:t)!=null?s.faveCount:s,{name:"friendlyNumber",hash:{},data:i}))},10:function(e,t,n,r,i){var s;return'		    <a href="#" title="'+((s=n["if"].call(t!=null?t:{},t!=null?t.loadingView:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.program(13,i,0),data:i}))!=null?s:"")+'" data-action="fave"></a>\n'},11:function(e,t,n,r,i){return e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"fave-view.LOADING_FAVES"},data:i}))},13:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},(s=t!=null?t.photo:t)!=null?s.isFaved:s,{name:"if",hash:{},fn:e.program(14,i,0),inverse:e.program(16,i,0),data:i}))!=null?s:""},14:function(e,t,n,r,i){return e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"fave-view.UNFAVE_PHOTO"},data:i}))},16:function(e,t,n,r,i){return e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"fave-view.FAVE_PHOTO"},data:i}))},18:function(e,t,n,r,i){return'		    <a href="#" title="'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"fave-view.WHO_FAVED"},data:i}))+'" data-action="showfaves"></a>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return'<div class="button">\n	<span class="fave-star '+((s=n["if"].call(o,(s=t!=null?t.photo:t)!=null?s.isFaved:s,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n.unless.call(o,(s=t!=null?t.photo:t)!=null?s.canFave:s,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n		<svg class="icon icon-fave"><use xlink:href="#icon-fave"></use></svg>\n		<svg class="icon icon-fave_hollow"><use xlink:href="#icon-fave_hollow"></use></svg>\n	</span>\n	<span class="fave-count" unselectable="on">'+((s=n["if"].call(o,t!=null?t.realFullscreen:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:"")+'</span>\n\n	<div class="button-overlay">\n'+((s=n["if"].call(o,(s=t!=null?t.photo:t)!=null?s.canFave:s,{name:"if",hash:{},fn:e.program(10,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,(s=t!=null?t.photo:t)!=null?s.faveCount:s,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.noop,data:i}))!=null?s:"")+"	</div>\n</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fave",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-person",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=e.lambda,u=e.escapeExpression;return"data-"+u(o((s=t!=null?t.dataAttr:t)!=null?s.key:s,t))+'="'+u(o((s=t!=null?t.dataAttr:t)!=null?s.value:s,t))+'"'},3:function(e,t,n,r,i){var s;return e.escapeExpression(e.lambda((s=t!=null?t.buddyicon:t)!=null?s["default"]:s,t))},5:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n.buddyicon||(t!=null?t.buddyicon:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"buddyicon",hash:{},data:i}):s))},7:function(e,t,n,r,i){return'	<a class="remove-person hide-text ui-icon-comment-delete" href="#">x</a>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'<li class="person" '+((s=n["if"].call(u,t!=null?t.dataAttr:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n	<a class="'+l((o=(o=n.extraClasses||(t!=null?t.extraClasses:t))!=null?o:a,typeof o===f?o.call(u,{name:"extraClasses",hash:{},data:i}):o))+'" href="/photos/'+l((o=(o=n.pathAlias||(t!=null?t.pathAlias:t))!=null?o:a,typeof o===f?o.call(u,{name:"pathAlias",hash:{},data:i}):o))+'/" data-track="'+l((o=(o=n.dataTrackPrefix||(t!=null?t.dataTrackPrefix:t))!=null?o:a,typeof o===f?o.call(u,{name:"dataTrackPrefix",hash:{},data:i}):o))+'PersonIconClick">\n		<span class="person-icon">\n			<span class="circle-icon" data-person-nsid="'+l((o=(o=n.nsid||(t!=null?t.nsid:t))!=null?o:a,typeof o===f?o.call(u,{name:"nsid",hash:{},data:i}):o))+'">\n				<img src="'+((s=n["if"].call(u,(s=t!=null?t.buddyicon:t)!=null?s["default"]:s,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.program(5,i,0),data:i}))!=null?s:"")+'" width="'+l((o=(o=n.size||(t!=null?t.size:t))!=null?o:a,typeof o===f?o.call(u,{name:"size",hash:{},data:i}):o))+'" height="'+l((o=(o=n.size||(t!=null?t.size:t))!=null?o:a,typeof o===f?o.call(u,{name:"size",hash:{},data:i}):o))+'">\n			</span>\n			<span class="person-name">\n				'+l((n.truncate||t&&t.truncate||a).call(u,t!=null?t.displayname:t,20,{name:"truncate",hash:{},data:i}))+"\n			</span>\n		</span>\n	</a>\n"+((s=n["if"].call(u,t!=null?t.showRemove:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))!=null?s:"")+"</li>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/person",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-fave-menu",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=t!=null?t:{};return"	<ul>\n"+((s=n.each.call(o,t!=null?t.people:t,{name:"each",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.moreCount:t,{name:"if",hash:{},fn:e.program(4,i,0),inverse:e.noop,data:i}))!=null?s:"")+"	</ul>\n"},2:function(e,t,n,r,i){var s;return(s=e.invokePartial(r.person,t,{name:"person",data:i,indent:"			",helpers:n,partials:r,decorators:e.decorators}))!=null?s:""},4:function(e,t,n,r,i){var s;return"			<li class='faves-more'><a href='#'>"+e.escapeExpression((s=(s=n.moreCount||(t!=null?t.moreCount:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"moreCount",hash:{},data:i}):s))+" more</a></li>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.people:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:""},usePartial:!0,useData:!0}),r={};e.Array.each(["person"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fave-menu",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-person"]});
YUI.add("animation-manager",function(e){e.AnimationManager=function(){function i(){return n=!1,r=[],!YUI.Env.isServer&&!e.config.win.requestAnimationFrame&&s(),{subscribe:u}}function s(){var t=["webkit","moz"],n,r,i=0;for(r=0;r<t.length&&!e.config.win.requestAnimationFrame;++r)n=t[r],e.config.win.requestAnimationFrame=e.config.win[n+"RequestAnimationFrame"],e.config.win.cancelAnimationFrame=e.config.win[n+"CancelAnimationFrame"]||e.config.win[n+"CancelRequestAnimationFrame"];if(!e.config.win.requestAnimationFrame||!e.config.win.cancelAnimationFrame)e.config.win.requestAnimationFrame=function(e){var t=Date.now(),n=Math.max(i+16,t);return setTimeout(function(){e(i=n)},n-t)},e.config.win.cancelAnimationFrame=clearTimeout}function o(){if(!n)return;r.forEach(function(e,t){e()}),e.config.win.requestAnimationFrame(o)}function u(t){return r.push(t),n||(n=!0,e.config.win.requestAnimationFrame(o)),{detach:function(){r.splice(r.indexOf(t),1),r.length||(n=!1)}}}var t,n,r;return t||(t=i()),t}()},"@VERSION@",{requires:[]});
YUI.add("photo-people-who-faved-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photos-getFavorites"].run(t,this.appContext)}},attributes:{total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return t=e.AttributeHelpers.coerceInteger(t),t<0&&(t=0),t},defaultValue:0},people:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photos-getFavorites"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getFavorites-fetcher"]});
YUI.add("flickr-photos-getFavorites-fetcher",function(e,t){"use strict";function n(t){var n;return n={photo_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||50,page:t.page||1,hermes:1},t.scrappy&&(n.sort="date_asc"),n}function r(t,n,r){var i=t[0],s=t[1],o=t[2],u;return u={id:i.photo.id,total:i.photo.total,people:[]},i.photo.person&&i.photo.person.forEach(function(t){var n=e.APIHelper.response.parsePerson(t);u.people.push(o.addOrUpdate(n))}),u.people={perPage:r.per_page,page:r.page,pageContent:u.people,totalItems:parseInt(u.total||0,10)},s.addOrUpdate(u),u.people.pageContent}function i(n,r){var i=this,s;return r.flipper.isFlipped("enable-scrappy-photo-page")&&(n.scrappy=!0),s=this._processParams(n),e.Promise.all([r.callAPI("flickr.photos.getFavorites",s,!0),r.getModelRegistry("photo-people-who-faved-models"),r.getModelRegistry("person-models")]).then(function(e){return i._processResponse(e,n,s)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-photos-getFavorites"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-people-who-faved-models","person-models"]});
YUI.add("fave-view",function(e,t){var n=require("lib/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.offNetworkFave=e.offNetworkFave||!1,this.hideWhoFaved=e.hideWhoFaved||!1,this.get("container").get("innerHTML")===""&&this.setContainerWithTemplate("fave",{photo:{canFave:!1},loadingView:!0}),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),this.realFullscreen=!!e.realFullscreen,this},buildContainer:function(){var e=this.get("photo-engagement");return this.setContainerWithTemplate("fave",{photo:e.toJSON(),realFullscreen:this.realFullscreen}),this},loadState:function(){var t=this,n=this.appContext.getViewer(),r=[];return r.push(this.appContext.getModel("photo-engagement-models",this.photoId).then(function(e){t.set("photo-engagement",e)})),n.signedIn&&r.push(this.appContext.getModelRegistry("favorite-models").then(function(e){t.set("favoriteModelRegistry",e)})),n.signedIn&&t.appContext.getModel("person-models",n.nsid).then(function(e){t.set("viewer-person-model",e)}),e.Promise.all(r)},activate:function(){var t=this.get("photo-engagement"),r=this,i,s=this.appContext.getViewer().prefs.keyboardShortcutsEnabled,o,u=this.appContext.getViewer().nsid,a=this.get("container").one(".fave-star");return t&&this.registerEventHandler(t.on("valuesChanged",function(i){var s,f=typeof i.faveCount!="undefined"||typeof i.isFaved!="undefined"||typeof i.canFave!="undefined";if(!f)return;a.addClass("is-transitioning"),setTimeout(function(){i&&i.isFaved&&i.isFaved.newVal?a.addClass("is-faved"):a.removeClass("is-faved")},225),setTimeout(function(){a.removeClass("is-transitioning")},300);var l=r.get("favoriteModelRegistry");l&&l.exists&&l.exists(u)&&(o=l.proxy(u).getValue("photoPageList"),i.isFaved&&i.isFaved.newVal?r.appContext.getModel("photo-models",i.isFaved.id).then(function(e){o.unshift(e)}):o.remove(i.isFaved.id)),s=t.remoteUpdate(),s.then(function(){r.processingFave=!1},function(n){n.code!==3&&(n.code!==5&&e.Object.each(i,function(e,n){t.setValue(n,e.prevVal)}),r.fire("subviewViewEvent","getDialogOffset",function(t){var n=new e.Views.FluidModal({appContext:this.appContext,title:r.intlMessage({intlName:"common.ERROR"}),message:r.intlMessage({intlName:"fave-view.COULDNT_FAVE"}),actionButtonLabel:r.intlMessage({intlName:"common.OK"}),showCancelButton:!1,classList:"scrappy-dialog"});n.show()})),r.processingFave=!1}).then(null,function(e){r.processingFave=!1,n.error({err:e})})},r.photoId)),i={":fave":r.faveStarClicked},this.attachEvents(i),s&&r.attachKeyEvent("down:70",r.faveStarClicked.bind(r)),this},showSignUpAndFaveModal:function(t){var n=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),r=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"}),i;i=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:n,signUpMessage:r,beaconPrefix:"fave"}),i.on("signUpClick",function(n){e.SigninHelper.signUpPendingFave({id:t})}),i.on("signInClick",function(n){e.SigninHelper.addPendingFave({id:t})}),i.show()},faveStarClicked:function(t,n){var r=this,i=this.get("photo-engagement"),s=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_MESSAGE"}),o=this.intlMessage({intlName:"fave-view.SIGN_IN_AND_FAVE"}),u=this.intlMessage({intlName:"common.CANCEL"}),a;t.preventDefault();if(this.processingFave)return;e.rapidTracker.beacon(this.name,"faveButtonClick"),this.processingFave=!0,this.bringIntoFocus();if(!this.appContext.getViewer().signedIn){if(this.offNetworkFave){e.SigninHelper.addPendingFave({id:this.photoId},{withPopup:!0,closeWhenDone:!0}),this.processingFave=!1;return}if(this.signedOutTest)return this.processingFave=!1,this.showSignUpAndFaveModal(this.photoId);a=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),htmlMessage:s,actionButtonLabel:o,cancelButtonLabel:u}),a.on("actionClick",function(){e.rapidTracker.beacon(r.name,"faveModalSigninClick"),e.SigninHelper.addPendingFave({id:r.photoId})}),a.on("cancelClick",function(t){e.rapidTracker.beacon(r.name,"faveModalCancelClick")}),a.show(),this.processingFave=!1}else i.getValue("canFave")&&(i.registry.toggleFave(this.photoId),e.rapidTracker.beacon(this.name,"faveStarActionBarButtonClick"))}})},"@VERSION@",{requires:["flickr-view","hermes-template-fave","fluid-modal-view","signin-helper","hermes-template-fave-menu","hermes-template-person","animation-manager"],optional:["photo-engagement-models","photo-people-who-faved-models","person-models","favorite-models"],langBundles:["fave-view","common"]});
YUI.add("feed-card-factory",function(e,t){var n=4,r=1;e.FeedCardFactory=function(){function e(e){var t=e.getValue("photos").getFirstItem().item,n=e.toJSON();n.photos[0].bestSize=i.call(this,n,t),this.isMobile&&n.photos[0].title.length>45||n.photos[0].title.length>68?n.photos[0].displayTitle=n.photos[0].title.slice(0,this.isMobile?45:68)+"...":n.photos[0].title.trim().length===0&&(n.photos[0].title=!1),n.cardWidth=this.initialCardWidth;if(n.photos[0].bestSize.width<this.initialCardWidth/2)n.cardHeight=n.photos[0].bestSize.height,n.isSmallerThanCard=!0;else{var r=this.initialCardWidth/n.photos[0].bestSize.width;n.cardHeight=n.photos[0].bestSize.height*r}n.photos[0].safetyLevel>this.safeSearch&&(n.photos[0].isInappropriate=!0),n.isSinglePhoto=!0,n.nonCuratedRec=!n.curated&&n.recommended;var s=t.getValue("engagement").getValue("faveCount"),o=t.getValue("engagement").getValue("commentCount"),a=t.getValue("engagement").getValue("viewCount");return n.favesCount=s,n.moreThan99Faves=s>99,n.commentsCount=o,n.moreThan99Comments=o>99,n.viewsCount=a,n.photo=n.photos[0],u.call(this,n)}function t(e){var t,i,s=e.getValue("photos").getList(),o=e.toJSON(),a=this,f=[],l=0;o.photos.length>this.maxPhotosShownOnCard&&(o.photos=o.photos.slice(0,this.maxPhotosShownOnCard));for(var c=0;c<o.photos.length;c++){var h=1;s[c].getValue("aspectRatio")>=1?(i=s[c].getSizeToFit({width:this.initialCardWidth,height:this.initialCardWidth}),t=s[c].getSizeToFit({width:this.initialCardWidth/r,height:i.height/r})):(i=s[c].getSizeToFit({width:this.initialCardWidth}),t=s[c].getSizeToFit({width:this.initialCardWidth/r,height:i.height/r})),o.photos[c].bestSize=t,h=this.initialCardWidth/t.width,f.push({aspectRatio:s[c].getValue("aspectRatio"),height:t.height*h,left:0,top:l,width:t.width*h}),l+=f[f.length-1].height+n}return l-=n,o.count>this.maxPhotosShownOnCard&&(o.displayViewMore=!0,o.howManyMore=o.count-this.maxPhotosShownOnCard),o.layout={containerHeight:l,widowCount:0,boxes:f},o.layout.boxes.map(function(e,t){return o.photos[t].safetyLevel>a.safeSearch&&(o.photos[t].isInappropriate=!0),e.photo=o.photos[t]}),o.displayViewMore&&o.layout.boxes.length&&(o.layout.boxes[o.layout.boxes.length-1].hasViewMoreLink=!0,o.howManyMore++),o.cardWidth=this.initialCardWidth,o.cardHeight=o.layout.containerHeight,u.call(this,o)}function i(e,t){var n=t.getValue("aspectRatio")<1,i=t.getValue("aspectRatio")===1,s,o,u;s=t.getSizeToFit({width:this.initialCardWidth,height:this.initialCardWidth});if(i)o=this.initialCardWidth,u=this.initialCardWidth;else if(n){var f=a();o=Math.max(this.initialCardWidth,s.width)*1.1,u=Math.min(f,s.height)*1.1}else o=this.initialCardWidth,u=s.height;return t.getSizeToFit({width:o/r,height:u/r})}function s(n){var r=n.getValue("count")===1,i={};return r?i=e.call(this,n):i=t.call(this,n),i}function o(e){var t=e.eventType,n="";return e.isSinglePhoto=e.count===1,t&&(t!=="Flickrec"&&t!=="StaticRec"||!e.isSinglePhoto?t!=="Flickrec"&&t!=="StaticRec"||!!e.isSinglePhoto?t==="SelfBatch"&&e.isSinglePhoto?n="feed-single-photo-card":t==="SelfBatch"&&!e.isSinglePhoto?n="feed-batch-photos-card":t==="UploadBatch"&&e.isSinglePhoto?n="feed-single-photo-card":t==="UploadBatch"&&!e.isSinglePhoto?n="feed-batch-photos-card":t==="GroupBatch"&&e.isSinglePhoto?n="feed-group-activity-single-card":t==="GroupBatch"?n="feed-group-activity-batch-card":n="feed-single-photo-card":n="feed-batch-photos-card":n="feed-single-photo-card"),n}function u(e){if(e.eventType==="GroupBatch"&&e.iconUrls){var t=e.iconUrls.default;t.indexOf("https")===-1&&(t=t.replace("http","https")),e.iconUrl=t}return e.loading=!0,e.videoOnHover=this.videoOnHover,this.isMobile&&(e.isMobile=this.isMobile,e.initialCardWidth=this.initialCardWidth),e.photosAndVideos=!1,e.justPhotos=!1,e.justVideos=!1,e.photosCount>0&&e.videosCount>0?e.photosAndVideos=!0:e.photosCount>0&&e.videosCount===0?e.justPhotos=!0:e.photosCount===0&&e.videosCount>0&&(e.justVideos=!0),e.eventType==="GroupBatch"?e.menuType="group":e.recommended&&e.curated?e.menuType="curated":e.recommended&&!e.curated?e.menuType="rec":e.menuType="basic",!this.sawFirstGroupCard&&e.eventType==="GroupBatch"&&(this.sawFirstGroupCard=!0),e}function a(){var e=800,t=50,n=150;return e-t-n}return this.init=function(e){return this.appContext=e.appContext,this.maxPhotosShownOnCard=e.maxPhotosShownOnCard,this.initialCardWidth=e.initialCardWidth,this.videoOnHover=e.videoOnHover,this.safeSearch=e.safeSearch,this.sawFirstGroupCard=!1,this},{init:this.init,getCardTemplateForCard:o,processSinglePhotoCardObject:e,processBatchPhotoCardObject:t,getCardData:s}}()},"@VERSION@",{optionalRequires:["feed-layouts"],requires:[]});
YUI.add("feed-page-view",function(e,t){var n=require("lib/flog")(t),r=120,i=480,s=4,o=2,u=6,a=8,f=4,l=792600581,c=792600632,h=792600633,p=792600631,d=792600635,v=792600634;e.namespace("Views")[this.name]=e.Base.create("feed-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.currentPage=1,this.perPage=30,this.viewportHeight=this.appContext.viewportData.getHeight(),this.viewportWidth=this.appContext.viewportData.getWidth(),this.preRenderedCardsCount=o,this.appContext.flipper.isFlipped("enable-feed-correct-layout")?(r=96,i=400,this.viewportWidth>i*4+r*3?this.preRenderedCardsCount=4:this.viewportWidth>i*3+r*2&&(this.preRenderedCardsCount=3)):this.viewportWidth>1800&&(this.preRenderedCardsCount=3),this.initialCardWidth=i,this.perBatch=u;if(this.isMobile||this.appContext.flipper.isFlipped("enable-single-desktop-layout-feed"))this.initialCardWidth=Math.max(this.viewportWidth,320),this.perPage=20,this.isSingleColumn=!0,this.preRenderedCardsCount=this.perPage;this.masonryLayout={columnWidth:this.initialCardWidth,gutter:r,transitionDuration:0,itemSelector:".activity-card"},this.viewCounter=this.appContext.getViewCounter(),this.videoPlayers={},this.videoOnHover=!this.isMobile,this.forceAds=t.forceAds,this.showAds=t.showAds,this.proUpsellOnly=!this.forceAds,this.resetFeedFilter=t.resetFeedFilter;var n=this.resetFeedFilter?"all":e.StorageHelper.getItem("filterFeedEvents")||"all";return t.subnavConfig={selected:n},n!=="all"&&(this.showAds=!1),this.setSpacesId(n),this.safeSearch=t.safeSearch,this.nsid=t.nsid,this.lastPageRendered=0,this.pagesCountInfiniteLoaded=f,this.enableInfiniteLoad=!0,this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-feed-subnav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"groups-recommended-list-view":{fromFeed:!0,requiredToShowOnClient:!1,requiredToShowOnServer:!1}},loadState:function(){var t=this;return this.cardFactory=e.FeedCardFactory.init({appContext:this.appContext,isMobile:this.isMobile,safeSearch:this.safeSearch,videoOnHover:!this.isMobile,maxPhotosShownOnCard:s,initialCardWidth:this.initialCardWidth,targetRowHeight:this.targetRowHeight}),this.appContext.getModel("activity-models",{id:this.nsid,eventTypes:this.getEventTypes(),page:this.currentPage,perPage:this.perPage,perBatch:this.perBatch}).then(function(e){return this.set("feedModel",e),e.getValue("activityList").getPage({eventTypes:this.getEventTypes(),invalidate:!0,page:this.currentPage,perPage:this.perPage,perBatch:this.perBatch}).then(function(e){e.length?(t.set("feedfirstPage",e),t.nothingToShow=!1,t.loadingFailed=!1):t.nothingToShow=!0},function(e){t.loadingFailed=!0})}.bind(this))},setSpacesId:function(e){e==="groups"?(this.set("spaceid",h),this.set("previewSpaceid",v)):e==="people"?(this.set("spaceid",c),this.set("previewSpaceid",d)):(this.set("spaceid",l),this.set("previewSpaceid",l))},getEventTypes:function(){var t="UploadBatch,FlickRec,StaticRec,GroupBatch",n;return this.resetFeedFilter?YUI.Env.isServer||e.StorageHelper.setItem("filterFeedEvents","all"):YUI.Env.isServer||(n=e.StorageHelper.getItem("filterFeedEvents"),n&&(n==="groups"?t="GroupBatch":n==="people"&&(t="UploadBatch"))),t},buildHeadContainer:function(){var e="";e+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, initial-scale=1, maximum-scale=1"}),YUI.Env.isServer&&this.set("headContainer",e)},preRenderCards:function(e){var t=this.get("feedfirstPage"),n=0,i=this,s="",o=[],u=[];for(var a=0;a<e;a++)t[a]&&o.push(t[a]);u=this.buildCardsData.call(this,o);for(var f=0;f<u.length;f++){var l=i.cardFactory.getCardTemplateForCard(u[f]);u[f].loading=!1,u[f].manualPosition={top:0,left:n},s+=this.templates(l)(u[f]),this.isSingleColumn||(n+=r)}return s},buildContainer:function(){if(this.loadingFailed)return this.setContainerWithTemplate("feed-page",{failedLoading:!0}),this;if(this.nothingToShow)return this.noMoreGroupActivity=this.getEventTypes()==="GroupBatch",this.setContainerWithTemplate("feed-page",{nothingToShow:!0,noMoreGroupActivity:this.noMoreGroupActivity}),this;var e=this.preRenderCards.call(this,this.preRenderedCardsCount);return this.setContainerWithTemplate("feed-page",{preRenderedCards:e,isSingleColumn:this.isSingleColumn,singleColumnWidth:this.initialCardWidth,videoOnHover:this.videoOnHover}),this},activate:function(){if(this.loadingFailed||this.nothingToShow&&this.noMoreGroupActivity)return;if(this.nothingToShow&&!this.noMoreGroupActivity){var t=this.get("container").one(".back-all-activity");t&&this.registerEventHandler(t.on("click",function(){e.StorageHelper.setItem("filterFeedEvents","all"),this.appContext.flapp.navigate("/")}.bind(this)));return}var n=this,r=this.get("container"),i=require("masonry-layout"),s=0;this.feedElement=r.one(".feed")?r.one(".feed").getDOMNode():!1,this.isSingleColumn||(this.msnry=new i(".feed",this.masonryLayout));var o=this.get("feedfirstPage"),u=this.get("container").all(".activity-card"),a=u?this.get("container").all(".activity-card:not(.pro-upsell-card)").size():0;for(var f=a;f>0;f--)o.length&&(s+=o[0].getValue("photos").size(),o.shift());this.appendCards.call(n,n.buildCardsData.call(this,o,!0)),setTimeout(function(){n.preloadNextPage.call(n)},500),this.isMobile||this.registerEventHandler(r.delegate("click",this.onPhotoClick.bind(this),".activity-card-photo")),this.registerEventHandler(r.delegate("click",this.onShareClick.bind(this),".activity-card-share:not(.sharing-disabled)")),this.registerEventHandler(r.delegate("click",this.onFaveClick.bind(this),".activity-card-fave")),this.registerEventHandler(r.delegate("click",this.onCommentClick.bind(this),".activity-card-comment")),this.registerEventHandler(r.delegate("click",this.onHideRecommendationClick.bind(this),".dismiss-rec")),this.registerEventHandler(r.delegate("click",this.clickComment.bind(this),".comment-count")),this.appContext.flipper.
isFlipped("enable-feed-card-caret")&&this.registerEventHandler(r.delegate("click",this.onCardMenuClick.bind(this),".feed-ctx-menu-caret")),this.registerEventHandler(r.delegate("key",this.onShareClick.bind(this),"down:13",".activity-card-share:not(.sharing-disabled)")),this.registerEventHandler(r.delegate("key",this.onFaveClick.bind(this),"down:13",".activity-card-fave")),this.registerEventHandler(r.delegate("key",this.onCommentClick.bind(this),"down:13",".activity-card-comment")),this.registerEventHandler(r.delegate("key",this.onHideRecommendationClick.bind(this),"down:13",".dismiss-rec")),this.registerEventHandler(r.delegate("key",this.clickComment.bind(this),"down:13",".comment-count")),this.videoOnHover&&(this.registerEventHandler(r.delegate("mouseenter",this.onHoverPhoto.bind(this),".activity-card-photo")),this.registerEventHandler(r.delegate("mouseleave",this.onUnHoverPhoto.bind(this),".activity-card-photo")),this.registerEventHandler(e.globalEvents.subscribe("window:blur",this.onBlurWindow.bind(this)))),e.on("feed:rebuildCard",this.rebuildCard.bind(this)),this.registerEventHandler(r.delegate("keyup",this.applyKeyboardFocusStyling.bind(this),".activity-card-photo")),this.registerEventHandler(r.delegate("blur",this.removeKeyboardFocusStyling.bind(this),".activity-card-photo")),this.registerEventHandler(r.delegate("blur",this.hideDismissRecButton.bind(this),".activity-card-photos")),this.registerEventHandler(r.delegate("focus",this.toggleAriaHidden.bind(this,!1),".activity-card-attribution *")),this.registerEventHandler(r.delegate("blur",this.toggleAriaHidden.bind(this,!0),".activity-card-attribution *"));var l=window.paftTiming["feed-page-view"];return l&&s&&(this.checkAFT=setInterval(function(){if(Object.keys(l).length===s){clearInterval(n.checkAFT);var t=0;for(var i in l){var o=r.one('[data-photo-id="'+i+'"]');o&&o.getXY()[1]<n.getContainingElementData().height&&(t=Math.max(t,l[i]))}t&&(this.appContext.hasClientSideRouted()?(this.appContext.clientMetrics.mark("AFT_CL",t),this.appContext.clientMetrics.mark("AFT",t)):(e.config.win.performance&&e.config.win.performance.timing&&(t-=e.config.win.performance.timing.navigationStart),this.appContext.clientMetrics.record("AFT_SV",t),this.appContext.clientMetrics.record("AFT",t)),this.appContext.clientMetrics.setPendingMeasurement("feed-page-view",!1),this.appContext.clientMetrics.beacon())}},200)),this.listenForAdPostMessages(),setTimeout(n.checkIfAdBlock.bind(n),3e3),this.scrollHandler=this.registerEventHandler(e.globalEvents.subscribe("window:scroll",this.handleScroll.bind(this))),!this.isMobile&&this.appContext.flipper.isFlipped("enable-email-verify-modal")&&(this.verifyEmailCookie=this.appContext.getCookie("flrbrgs"),this.verifyEmailCookie||this.appContext.getModel("account-email-model",{id:n.nsid}).then(function(e){n.emailModel=e}).then(function(){var e=n.emailModel.toJSON(),t=!0;for(var r=0;r<e.emails.length&&t===!0;r++){var i=e.emails[r];if(e.account.loginEmail!==i.email&&i.emailConf==="1"){t=!1;break}}t&&n.showEmailDialog()})),this},listenForAdPostMessages:function(){var t=this;e.config.win.addEventListener("message",function(e){if(!(e&&e.origin.indexOf("//y-flickr.yahoo.com")>-1))return;if(e.data){var n={};e.data.split("&").forEach(function(e){var t=e.split("=");n[t[0]]=t[1],t[0]==="no_ad"&&n.no_ad===t[1]==="true"}),n.no_ad?t.checkForAdAndMakeUpsell.call(t,n.adid):t.setAdvertiserInfo.call(t,n.ad)}})},checkForAdAndMakeUpsell:function(e){var t,n,r=typeof e!="string"?e:null,i=this.get("container");n=setInterval(function(){t=r||i.one("#"+e),t&&(clearInterval(n),t.one(".pro-upsell").removeClass("hide-upsell"),t.one(".ad-iframe").addClass("hide-ad"))},100)},setAdvertiserInfo:function(e){},checkIfAdBlock:function(){var e=this,t;t=document.createElement("div"),t.innerHTML="&nbsp;",t.className="adsbox",document.body.appendChild(t),window.setTimeout(function(){t.offsetHeight===0&&e.get("container").all(".activity-card.ad-card").each(function(t){e.checkForAdAndMakeUpsell(t)}),"remove"in t?t.remove():t.parentNode.removeChild(t)},100)},getContainingElementData:function(){var t,n=this.get("container");return t={height:0,scrollLeft:0,scrollTop:0},t={height:this.appContext.viewportData.getHeight(),scrollLeft:YUI.Env.isServer?0:e.config.win.pageXOffset,scrollTop:YUI.Env.isServer?0:e.config.win.pageYOffset},n&&(t.scrollLeft-=n.get("offsetLeft"),t.scrollTop-=n.get("offsetTop")),t},buildCardsData:function(e,t){var n=[],r=this.cardFactory;if(!e)return;for(var i=0;i<e.length;i++){var s=r.getCardData(e[i]);n.push(s)}return!YUI.Env.isServer&&this.showAds&&e.length&&(n=this.insertAdCard(e,n,t)),n},checkProAndAdjustOffset:function(e,t){if(e+2>=t.length)return-1;var n=[2,1,0,-1,-2],r=!1,i;return r=n.some(function(n){return t[e+n].getValue("photos").getList().some(function(e){var t=e.getValue("owner").getValue("isPro");return t&&(n<0?i=0:i=n),t})}),r?this.checkProAndAdjustOffset(e+i+4,t):e},insertAdCard:function(e,t,n){var r,i=a,s=!1,o;return i=this.checkProAndAdjustOffset(8,e),i===-1&&(s=!0,i=a),o=n?i:a*2,r=this.makeAdCard(o,s),e.length>i?t.splice(i,0,r):t.push(r),t},makeAdCard:function(t,n){var r,i=e.guid(),s=this.get("spaceid"),o=t>a?"LREC3":"LREC2";return r={isAd:!0,loading:!0,eventType:"ad",cardHeight:480,contentHeight:250,proUpsellOnly:this.proUpsellOnly||n,guid:i,adSrc:"//y-flickr.yahoo.com/ad?spaceid="+s+"&position="+o+"&adid="+i},r},appendCards:function(t){var r=this,i=this.get("container"),s="",o;for(var u=0;u<t.length;u++)o=r.cardFactory.getCardTemplateForCard(t[u]),s+=this.templates(o)(t[u]);i.one(".balls")&&i.one(".balls").remove(),i.one(".feed").append(s),this.msnry&&this.msnry.reloadItems(),setTimeout(function(){var t=i.one(".load-more");r.msnry&&r.msnry.layout(),e.DeferImages.update(),i.all(".loading").removeClass("loading"),i.all(".disable-click").removeClass("disable-click"),t&&t.setStyle("display","block")},500);try{t&&t.length>0&&t[0].photos.length>0&&n.info("Appended "+t.length+" cards for page "+this.currentPage+" starting with "+t[0].photos
[0].owner.displayname)}catch(a){}},rebuildCard:function(t,n){var r=this.get("feedModel").getValue("activityList").find({id:t});if(r){var i,s,o;i=this.cardFactory.getCardTemplateForCard(r.toJSON()),s=this.cardFactory.getCardData(r),s.loading=!1;var u=this.get("container").one('.activity-card[data-activity-id="'+t+'"]');u&&(n?(o=this.templates("feed-card-engagement-actions")(s),u.one(".feed-card-actions").setHTML(o)):(o=this.templates(i)(s),u.setHTML(o),e.DeferImages.update()))}},disableCard:function(e){if(e&&e.card){e.card.addClass("disabled");var t=this.getActivityFromCard(e.card.getDOMNode());t?(t.setValue("isDisabled",!0),n.info("Card disabled")):n.warn("cant find activity to disable")}},onPhotoClick:function(t){var n="";if(t.button!==1||t.ctrlKey||t.metaKey)return;t.preventDefault(),t.stopPropagation();var r=this.getPhotoFromCard(t.currentTarget),i=this.getActivityFromCard(t.currentTarget);this.previewView&&this.previewView.destroy({remove:!0});if(t&&t.target){var s=t.target.siblings("img");s&&s.item(0)&&(n=s.item(0).getAttribute("src"))}this.previewView=(new e.Views.PreviewOverlay({appContext:this.appContext,activityId:i.getValue("id"),photoId:r.getValue("id"),photoModel:r,urlDisplayedOnFeed:n||"",previewSpaceId:this.get("previewSpaceid"),classList:"feed-preview",baseURL:"/",safeSearch:this.safeSearch})).show(),this.stopAllInFeedVideo()},visibleHeightOnViewport:function(){var e=this.viewportHeight||800,t=50,n=150;return e-t-n},stopAllInFeedVideo:function(){var e=this;this.hoveredIn=null,setTimeout(function(){e.hideBalls(),e.get("container").all(".video-button.show").each(function(e){e.show(),e.one(".icon-play").show()}),Object.keys(e.videoPlayers).forEach(function(t){e.videoPlayers[t].pause()})},10)},clickComment:function(e){var t=e.target.ancestor(".feed-card-actions",!0).one(".activity-card-comment");t&&t.getDOMNode().click()},onShareClick:function(t){var n=this.getPhotoFromCard(t.currentTarget);if(!n)return;var r=new e.Views["fluid-share-photo-view"]({appContext:this.appContext,photoId:n.id,nsid:n.getValue("owner").nsid});this.showBalls(),r.on("sharePresentationClose",r.destroy.bind(r)),r.initialize().then(function(){this.prepareModal(t.target)}.bind(r)).then(function(){this.hideBalls()}.bind(this)).catch(function(e){this.hideBalls()}.bind(this))},onFaveClick:function(t){var n=this.getPhotoFromCard(t.currentTarget),r=this.getActivityFromCard(t.currentTarget),i,s;if(!n)return;i=n.getValue("engagement"),s=!!i.getValue("canFave"),s&&(this.showBalls(),i.registry.toggleFave(n.id),i.registry.remoteUpdate(n.id).then(function(){e.fire("feed:rebuildCard",r.getValue("id"),!0),this.hideBalls()}.bind(this)).catch(function(t){e.fire("feed:rebuildCard",r.getValue("id"),!0),this.hideBalls()}.bind(this)))},onCommentClick:function(t){var n=Math.min(this.initialCardWidth-20,this.viewportWidth-40),r=this.getPhotoFromCard(t.currentTarget),i=this.getActivityFromCard(t.currentTarget),s=t.target,o,u;u=new e.Views["sub-photo-comments-view"]({appContext:this.appContext,photoId:r.id,focusInputOnActivate:!0,viewMoreLinkToPhotoPage:!0,fireEventWhenImagesCommentLoaded:!0,initiallyShowingMaximum:3,isTooltipComments:!0,showCommentButton:!0,textAreaMaxHeight:80}),o=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,preferTop:!0,preferLeft:!0,width:n,anchorOffsetHorizontal:30,mirrorArrowAdjustment:40,newReposition:!0,autoSizeToContent:!0,anchorOffsetVertical:5,classList:"feed-photo-comments under-nav",overlayClassList:"under-nav",anchorElement:s,keyboardAnchorElement:s,subview:u}),u.on("commentsImagesLoaded",function(e){o.repositionToElement(s)}),o.on("newCommentAdded",function(t){o.repositionToElement(s),e.fire("feed:rebuildCard",i.getValue("id"),!0)}),o.show()},onCardMenuClick:function(t){var n=this,r,i,s=t.target.ancestor(".activity-card"),o;i=t.target.getAttribute("data-menu-type"),t.target.addClass("expanded"),o=new e.Views["feed-card-menu-view"]({appContext:this.appContext,menuType:i,feedModel:this.get("feedModel"),activityCard:t.target.ancestor(".activity-card")}),r=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!1,preferTop:!1,preferBottom:!0,preferLeft:!0,width:this.initialCardWidth,anchorOffsetVertical:0,anchorOffsetHorizontal:0,mirrorArrowAdjustment:0,contentPadding:0,newReposition:!0,autoSizeToContent:!0,classList:"feed-activity-menu under-nav no-border no-border-radius",overlayClassList:"under-nav",anchorElement:t.target.ancestor(".activity-card").one(".activity-card-content"),subview:o}),r.show(),this.registerEventHandler(r.on("closeDroparound",this.handleCloseCardMenu.bind(this,t.target))),this.registerEventHandler(o.on("hideRec",function(e){s.remove(),n.msnry.layout()})),this.registerEventHandler(o.on("turnOff",this.disableCard.bind(this)))},onHideRecommendationClick:function(e){var t=this,n=e.currentTarget,r=this.getPhotoFromCard(n),i=this.getActivityFromCard(n),s=n.ancestor(".activity-card"),o={};e.preventDefault(),e.stopPropagation(),s&&s.remove(),t.msnry.layout(),o={photoId:r.getValue("id"),recId:i.getValue("recId")},this.get("feedModel").updateRecommendedFeedbackRemote(o.photoId,o.recId)},onHoverPhoto:function(t){var n=t.currentTarget,r=this.getPhotoFromCard(n),i,s=this;if(r&&r.getValue("isVideo")){Object.keys(this.videoPlayers).forEach(function(e){s.videoPlayers[e].pause()});var o=n.next(".video-button.show");o&&o.one(".icon-play")&&o.one(".icon-play").hide();if(n.one("div.video-js"))i=n.one("div.video-js")._node,s.hoveredIn=i.id,this.videoPlayers[i.id].play(),o.hide();else{i=n.one("video");if(i&&i._node){this.showBalls(o);var u=i._node.id,a=new e.FlickrVideoPlayer({container:n,model:r,appContext:this.appContext,videoNode:i._node,showControls:!1,controlBar:{fullscreenToggle:!1},autoplay:!0,loop:!0,muted:!0});a.init().then(function(){i&&i._node&&i._node.volume&&(typeof i._node.volume=="function"?i._node.volume(0):i._node.volume=0),a.volume&&a.volume(0),s.hoveredIn===u?(a.play(),o.hide()):a.pause(),s.
hideBalls()}).catch(function(){s.hideBalls(),o.hide()}),this.hoveredIn=u,this.videoPlayers[u]=a}}}},onUnHoverPhoto:function(e){var t=e.currentTarget,n;this.hoveredIn=null;var r=t.next(".video-button.show");r&&r.one(".icon-play")&&(r.one(".icon-play").show(),r.show()),t.one("div.video-js")&&(n=t.one("div.video-js"),n&&n._node&&this.videoPlayers[n._node.id]&&this.videoPlayers[n._node.id].pause())},onBlurWindow:function(){var e=this;this.get("container").all(".activity-card-photo .video-button.show").show();var t=this.get("container").all("div.video-js");t._nodes.forEach(function(t){e.videoPlayers[t.id]&&e.videoPlayers[t.id].pause()})},applyKeyboardFocusStyling:function(e){e.keyCode===9&&e.target.addClass("has-keyboard-focus");var t=e.target.next(".dismiss-rec");t&&t.addClass("show")},removeKeyboardFocusStyling:function(e){e.target.hasClass("has-keyboard-focus")&&e.target.removeClass("has-keyboard-focus")},hideDismissRecButton:function(t){var n=t.currentTarget.one(".dismiss-rec");n&&setTimeout(function(){e.one(document.activeElement).ancestor(".activity-card-photos")||n.removeClass("show")},1)},toggleAriaHidden:function(e,t){var n=t.target,r=e?"true":"false";if(!n.ancestor("[aria-hidden="+r+"]"))if(n.hasAttribute("aria-hidden"))n.setAttribute("aria-hidden",r);else{var i=n.ancestor("[aria-hidden="+(e?"false":"true")+"]");i&&i.setAttribute("aria-hidden",r)}},getPhotoFromCard:function(e){var t,n,r,i=null;t=this.getActivityFromCard.call(this,e);if(t){n=t.getValue("photos");if(n){var s=e.getAttribute("data-photo-id");s?i=n.getFromListByID(s):(r=n.getFirstItem(),r&&r.item&&(i=r.item))}}return i},getActivityFromCard:function(e){var t,n,r;return this.get("feedModel")&&(t=this.get("feedModel").getValue("activityList"),t&&(n=e.getAttribute("data-activity-id"),n&&n!==""&&(r=t.find({id:n})))),r},showBalls:function(t){this.balls||(this.balls=e.Node.create('<div class="loading-balls"></div>'),this.balls.setHTML(this.templates("flickr-balls")({}))),(t||this.get("container")).append(this.balls)},hideBalls:function(){this.balls&&this.balls.remove()},handleLoadMoreBtn:function(){this.enableInfiniteLoad||(this.pagesCountInfiniteLoaded=f-1,this.enableInfiniteLoad=!0),this.loadNextPage.call(this)},handleScroll:function(){this.addPhotoViews(),this.videoOnHover&&this.stopAllInFeedVideo();if(!this.enableInfiniteLoad)return;if(this.isInfiniteLoading||!this.feedElement)return;var t=this.feedElement.scrollHeight;t>this.viewportHeight*2&&(YUI.config.win.scrollY||e.config.win.pageYOffset)+this.viewportHeight*2>=t&&(n.info("Passed scroll threshold, now loading page "+this.currentPage),this.isInfiniteLoading=!0,this.infiniteLoadTimer&&clearTimeout(this.infiniteLoadTimer),this.infiniteLoadTimer=setTimeout(function(){this.loadNextPage().then(function(){this.isInfiniteLoading=!1}.bind(this)),this.pagesCountInfiniteLoaded--,this.pagesCountInfiniteLoaded<1&&(this.enableInfiniteLoad=!1,this.loadMoreHandler=this.registerEventHandler(this.get("container").delegate("click",this.handleLoadMoreBtn.bind(this),".load-more"))),e.rapidTracker.beacon(this.name,"feedPageScroll")}.bind(this),100))},addPhotoViews:function(){var e=document.querySelectorAll(".activity-card-photo"),t=this,n;Array.prototype.forEach.call(e,function(e){e&&t.isInViewport(e)&&(n=t.getPhotoFromCard(e),n&&t.viewCounter.queue(n.id,document.location.href))})},loadNextPage:function(){var t=this,r=t.get("container").one(".load-more button");return r.setAttribute("disabled","disabled"),this.currentPage===this.lastPageRendered?(n.warn("already rendered page "+this.currentPage+", skipping"),e.Promise.resolve()):t.get("feedModel").getValue("activityList").getPage({eventTypes:t.getEventTypes(),page:t.currentPage,perBatch:t.perBatch,perPage:t.perPage}).then(function(e){if(e&&e.length&&e.length>0){var n=t.buildCardsData.call(t,e);t.appendCards.call(t,n),t.lastPageRendered=t.currentPage,setTimeout(function(){r.removeAttribute("disabled"),t.preloadNextPage.call(t)},1e3)}else t.nothingElseToShow()})},preloadNextPage:function(e){return this.currentPage++,this.get("feedModel").getValue("activityList").getPage({eventTypes:this.getEventTypes(),page:this.currentPage,invalidate:e||!1,perPage:this.perPage,perBatch:this.perBatch}).then(function(e){if(!e||!e.length)this.nothingElseToShow.call(this),this.currentPage--}.bind(this))},nothingElseToShow:function(){var e=this.get("container"),t=e.all(".loading"),n=e.all(".disable-click"),r=e.one(".load-more"),i=e.one(".balls");i&&i.remove(),t&&t.removeClass("loading"),n&&n.removeClass("disable-click"),r&&r.remove()},isInViewport:function(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},onSubviewEvent:function(t,n){if(n[0]==="feed:filter"){if(n[1]&&n[1].eventType)return this.currentPage=0,e.StorageHelper.setItem("filterFeedEvents",n[1].eventType),this.appContext.getModelRegistry("activity-models").then(function(t){t.removeAll(),this.setContainerWithTemplate("feed-page",{isLoading:!0}),this.appContext.flapp.navigate(e.config.win.location.href)}.bind(this))}else if(n[0]==="group:joined")return this.currentPage=0,this.preloadNextPage(!0).then(function(e){var t=this.get("container").one(".refresh-btn");t&&(t.removeAttribute("disabled"),t.once("click",function(e){var t=this.get("container").one(".links #groups a");t&&t.getDOMNode().click(e)}.bind(this)))}.bind(this))},handleCloseCardMenu:function(e,t){e&&e.removeClass("expanded")},showEmailDialog:function(){var t=this,n=t.emailModel.getValue("account").loginEmail;this.emailModal=new e.Views.FluidModal({appContext:this.appContext,htmlMessage:this.templates("recovery-email-modal")({email:n}),showBodyLines:!1,showCancelX:!1,showActionButton:!1,showCancelButton:!1,showHeader:!1,showFooter:!1}),this.emailModal.show(),this.registerEventHandler(this.emailModal.on("activated",function(e){var n=e.target.get("container"),r=n.one("button.add-recovery-email-button"
),i=n.one("a.cancel-recovery-email-button"),s=n.one(".input-container input"),o=n.one(".input-container .validation-message");this.registerEventHandler(r.on("click",function(e){if(!r.hasClass("disabled")){r.addClass("disabled");var n=s.getDOMNode().value;t.emailModel.remoteUpdateEmail({email:n},t.appContext).then(function(e){t.emailModal.get("container").one(".content").setHTML(t.templates("recovery-email-confirm-modal")({email:n}));var r=t.emailModal.get("container").one(".recovery-email-confirm-modal-view"),i=r.one(".recovery-email-confirm-button");i.on("click",function(){t.emailModal.fire("actionClick")}.bind(t)),t.setVerifyEmailCookie()},function(e){s.addClass("invalid"),o.removeClass("hidden"),e.code===1?o.setHTML(t.intlMessage({intlName:"feed.RECOVERY_INVALID_EMAIL"})):e.code===3?o.setHTML(t.intlMessage({intlName:"feed.RECOVERY_EMAIL_IN_USE"})):e.code===5?o.setHTML(t.intlMessage({intlName:"feed.RECOVERY_EMAIL_ALREADY_YOURS"})):o.setHTML(t.intlMessage({intlName:"feed.RECOVERY_EMAIL_SOMETHING_WENT_WRONG"})),r.removeClass("disabled")})}}.bind(this))),this.registerEventHandler(i.on("click",function(e){this.emailModal.fire("actionClick"),this.setVerifyEmailCookie()}.bind(this)))}.bind(this)))},setVerifyEmailCookie:function(){var e=new Date;e.setDate(e.getDate()+7),this.appContext.setCookie({cookieName:"flrbrgs",cookieValue:1,path:"/",expires:e})}},{ATTRS:{spaceid:{value:l},previewSpaceid:{value:p}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-feed-single-photo-card","hermes-template-feed-batch-photos-card","hermes-template-feed-group-activity-batch-card","hermes-template-feed-group-activity-single-card","hermes-template-feed-card-engagement-actions","hermes-template-feed-card-attribution","hermes-template-feed-page","hermes-template-feed-loading-placeholder","hermes-template-head-meta","hermes-template-adult-content-overlay","hermes-template-recovery-email-modal","hermes-template-recovery-email-confirm-modal","groups-recommended-list-view","global-nav-view","footer-full-view","preview-overlay-view","url","activity-models","account-email-model","fluid-share-photo-view","fluid-droparound-view","sub-photo-comments-view","feed-card-menu-view","fave-view","feed-card-factory","storage-helper"],optionalRequires:["feed-layouts"],langBundles:["common","fave-view","share-modal","comments","relative-dates","feed","adult-content-overlay"]});
YUI.add("hermes-lang-client-app",function(e,t){e.Intl.add("hermes/client-app","en-US",{SAVING_LAST_ACTIONS:["Hey! We\u2019re still saving your last actions, you might lose them if you leave this page."],UPLOAD_IN_PROGRESS:["Wait! Your photos are still on the way to our servers. They might not get there if you leave this page before they arrive."]})},"@VERSION@",{requires:["intl"]});
