YUI.add("comment-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{create:function(t){return e.ModelCreators["flickr-photos-comments-addComment"].run(t,this.appContext)},update:function(t,n){return e.ModelUpdaters["flickr-photos-comments-editComment"].run({commentId:t,content:n.content.newVal},this.appContext)},"delete":function(t){return e.ModelDeletors["flickr-photos-comments-deleteComment"].run(t,this.appContext)}},attributes:{author:{isModel:!0},date:{},timeago:{readOnly:!0,derivedBy:["date"],getter:function(t,n){return e.moment.unix(this.getValue(n,"date"))}},permalink:{},content:{},contentSecure:{},contentRaw:{}}})},"@VERSION@",{requires:["flickr-model-registry","moment","flickr-photos-comments-addComment-creator","flickr-photos-comments-editComment-updater","flickr-photos-comments-deleteComment-deletor"]});
YUI.add("photo-comments-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{comments:{isListProxy:!0,rangeFetch:{listFetcher:e.ListFetchers["flickr-photos-comments-getList"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-comments-getList-fetcher"]});
YUI.add("flickr-photos-comments-getList-fetcher",function(e,t){"use strict";function n(t){var n,r=typeof t.textForPhotoLinks!="undefined"?t.textForPhotoLinks:!1;return n={photo_id:t.id,offset:t.offset||0,limit:t.limit||4,sort:t.sort||"date-posted-desc",extras:"icon_urls",expand_bbml:1,use_text_for_links:1,secure_image_embeds:1,bbml_need_all_photo_sizes:r?0:1,primary_photo_longest_dimension:e.config.flickr.comment_image_max_width},n}function r(t){var n=t[0],r=t[1],i=t[2],s=t[3],o=[],u=typeof n.comments.comment=="undefined"?0:n.comments.comment.length,a,f,l,c,h;return u>0&&e.Array.each(n.comments.comment,function(t,n,r){a={id:t.author,username:t.authorname,isDeleted:t.authorIsDeleted,realname:t.realname,pathAlias:t.pathAlias,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(t.iconurls),isAdFree:t.isAdFree,isPro:t.ispro},a.pathAlias=t.pathAlias,l=s.addOrUpdate(a),f={id:t.id,author:l,date:t.datecreate,permalink:t.permalink,content:t.content,contentRaw:t.rawComment.content,contentSecure:t.secureComment.content},o.push(i.addOrUpdate(f))}),r.exists(n.comments.photoId)?(c=r.proxy(n.comments.photoId).getValue("comments").getList(),h=c.concat(o),r.proxy(n.comments.photoId).setValue("comments",h)):r.add({id:n.comments.photoId,comments:o}),o}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.photos.comments.getList",this._processParams(n)),r.getModelRegistry("photo-comments-models"),r.getModelRegistry("comment-models"),r.getModelRegistry("person-models")]).then(i._processResponse,e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-photos-comments-getList"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise"],optional:["photo-comments-models","comment-models","person-models"]});
YUI.add("sub-photo-comments-view",function(e,t){var n=require("lib/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.initiallyShowingMaximum=e.initiallyShowingMaximum?e.initiallyShowingMaximum:20,this.showMoreMaximum=e.showMoreMaximum?e.showMoreMaximum:200,this.isTooltipComments=!!e.isTooltipComments,this.viewMoreLinkToPhotoPage=!!e.viewMoreLinkToPhotoPage,this.hideCommentButtonAfterComment=typeof e.hideCommentButtonAfterComment!="undefined"?e.hideCommentButtonAfterComment:this.isTooltipComments,this.currentlyShowingCount=0,this.initiallyShowingCount=0,this.isOnMobile=e.isOnMobile||!1,this.textAreaMaxHeight=e.textAreaMaxHeight||420,this.textAreaMinHeight=35,this.noIcons=e.noIcons,this.showCommentButton=e.showCommentButton||!1,this.includePermalink=e.includePermalink||!1,this.postingComment=!1,this.signedOutCommenting=this.appContext.flipper.isFlipped("enable-signed-out-commenting"),this.focusInputOnActivate=e.focusInputOnActivate||!1,this.fireEventWhenImagesCommentLoaded=e.fireEventWhenImagesCommentLoaded||!1,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var t=this,n=[],r;return r=this.getViewDataFromHistory("numberOfCommentsShowing"),typeof r!="undefined"&&(t.initiallyShowingCount=r,t.initiallyShowingCount>t.initiallyShowingMaximum&&(t.initiallyShowingMaximum=r)),n.push(this.appContext.getModelRegistry("comment-models").then(function(e){t.commentModelsRegistry=e})),n.push(this.appContext.getModel("photo-engagement-models",this.photoId).then(function(n){t.photoEngagement=n;var r=t.photoEngagement.getValue("commentCount"),i,s=/#comment/g;YUI.Env.isServer||(i=e.config.win.location.hash),i&&s.test(i)?(t.initiallyShowingCount=r,t.currentlyShowingCount=r):r>=t.initiallyShowingMaximum?(t.initiallyShowingCount=t.initiallyShowingMaximum,t.currentlyShowingCount=t.initiallyShowingMaximum):(t.initiallyShowingCount=r,t.currentlyShowingCount=r)}).then(function(){return t.appContext.getModel("photo-comments-models",t.photoId)}).then(function(e){t.photoComments=e;if(t.photoEngagement.getValue("commentCount")>0)return t.photoComments.getValue("comments").getRange({offset:0,limit:t.initiallyShowingCount,textForPhotoLinks:t.isTooltipComments}).then(function(e){t.set("comments",e)});t.set("comments",[])})),n.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){t.photoModel=e})),this.appContext.getViewer().signedIn&&n.push(t.appContext.getModel("person-models",t.appContext.getViewer().nsid).then(function(e){t.person=e})),e.Promise.all(n)},buildContainer:function(){var t=this.photoModel.getValue("url"),n=this.person?this.person.toJSON():null,r=this.get("comments"),i=this.calculateShowMoreCount(),s=i===1?this.intlMessage({intlName:"photo-page-scrappy.VIEW_PREVIOUS_COMMENT"}):this.intlMessage({intlName:"photo-page-scrappy.VIEW_MORE_PREVIOUS_COMMENTS",count:i}),o,u,a=/#comment/g;YUI.Env.isServer||(u=e.config.win.location.hash),r=r.reverse(),this.isTooltipComments&&(this.ellipsis=this.intlMessage({intlName:"comments.SEE_MORE_LINK",photoUrl:t}));for(o=0;o<r.length;o++)r[o]=r[o].toJSON?r[o].toJSON():r[o],r[o].isSignedIn=this.appContext.getViewer().signedIn,r[o].isLoggedInUsersPhoto=this.isLoggedInUsersPhoto(),r[o].canCommentBeDeleted=this.canCommentBeDeleted(r[o].author.nsid),r[o].commentBelongsToViewer=this.commentBelongsToViewer(r[o].author.nsid),r[o].enabledEditableComments=!0,r[o].canComment=this.photoModel.getValue("canComment"),r[o].isTooltipComment=this.isTooltipComments,r[o].viewMoreLinkToPhotoPage=this.viewMoreLinkToPhotoPage,r[o].ellipsis=this.ellipsis,r[o].noIcons=this.noIcons,r[o].enabledNewPro=this.appContext.flipper.isFlipped("enable-pro-badge"),r[o].isOnMobile=this.isOnMobile;return this.setContainerWithTemplate("sub-photo-comments-view",{user:n,isOnMobile:this.isOnMobile,comments:r,showMore:this.calculateShowMoreCount()>0,showMoreCount:this.calculateShowMoreCount(),showMoreString:s,canComment:this.signedOutCommenting?this.photoModel.getValue("canComment")||this.photoModel.getValue("canPublicComment"):this.photoModel.getValue("canComment"),tutorialMode:!0,isTooltipComments:this.isTooltipComments,viewMoreLinkToPhotoPage:this.viewMoreLinkToPhotoPage,photoUrl:t,showCommentButton:this.showCommentButton,includePermalink:this.includePermalink}),this.retinafyCommentImages(),u&&a.test(u)&&this.jumpToPermalinkedComment(),this},buildErrorContainer:function(){this.setContainerWithTemplate("sub-photo-comments-view",{loadingError:!0})},activate:function(){var t=this,n=t.get("container"),r=this.appContext.getViewer().prefs.keyboardShortcutsEnabled;this.appContext.flipper.isFlipped("enable-reactions")&&e.use("reactions-view",function(e){var r=n.one(".reactions-container");r&&t.appContext.getView("reactions-view",{photoId:t.photoId}).then(function(e){return e.initialize().then(function(){r.setHTML(e.get("container")),e.activate()})})}),n.one(".comments-more")&&t.registerEventHandler(n.one(".comments-more a").on("click",t.handleMoreCommentsClick.bind(t))),n.one("button.comment")&&t.registerEventHandler(n.one("button.comment").on("click",t.handleCommentButtonClick.bind(t))),n.one(".new-comment-text")&&(r&&this.attachKeyEvent("down:67",function(e){e.preventDefault();try{n.one(".new-comment-text").focus()}catch(t){}}),t.registerEventHandler(n.one(".new-comment-text").on("focus",function(){n.one("button.comment").setStyle("display","block").addClass("comment-text-focused"),n.one("button.comment").setAttribute("tabindex","0")})),t.registerEventHandler(n.one(".new-comment-text").on("blur",function(){!t.hideCommentButtonAfterComment&&n.one(".new-comment-text").get("value")===""&&n.one("button.comment").setStyle("display","none").removeClass("comment-text-focused")})),t.registerEventHandler(n.one(".new-comment-text").on("keydown",function(e){e.keyCode===9&&!e.shiftKey&&(n.one(".new-comment-text").get("value")!==""?(e.preventDefault(),n.one("button.comment"
).focus()):n.one("button.comment").setAttribute("tabindex","-1"))})),t.registerEventHandler(n.one("button.comment").on("key",function(e){e.preventDefault(),n.one(".new-comment-text").focus()},"down:9+shift"))),e.StorageHelper.getItem("pendingComment-"+this.photoId)&&this.get("container").one(".new-comment-text")&&(n.one(".new-comment-text").set("value",e.StorageHelper.getItem("pendingComment-"+this.photoId)),n.one("button.comment").setStyle("display","block").addClass("comment-text-focused")),e.use("transition",function(e){t.attachEvents({"keydown:comment":t.handleCommentKeyDown.bind(t),".comment-reply click:reply":t.handleReplyClick.bind(t),".comment-delete click:delete":t.handleDeleteClick.bind(t),".comment-edit click:edit":t.handleEditClick.bind(t),".done-editing-comment click:saveEdit":t.handleDoneEditingCommentClick.bind(t)})});if(this.focusInputOnActivate){var i=this.get("container").one(".new-comment-text");i&&setTimeout(function(){i.getDOMNode().focus()},100)}if(this.fireEventWhenImagesCommentLoaded){var s=this.get("container").all("img.notsowide"),o=s._nodes.length,u=0;s.on("load",function(e){u++,u===o&&setTimeout(function(){t.fire("commentsImagesLoaded")},100)})}return this.fire("activated"),this},postComment:function(t){var r=this,i,s,o,u,a=this.photoEngagement.getValue("commentCount");r.fire("addingNewComment");if(e.Lang.trim(t)===""){this.onError(this.intlMessage({intlName:"photo-page-scrappy.EMPTY_COMMENT_ERROR"})),this.postingComment=!1;return}e.rapidTracker.beacon(this.name,"commentPosted"),e.StorageHelper.remove("pendingComment-"+this.photoId),this.commentModelsRegistry.remoteCreate({photoId:this.photoId,commentText:t}).then(function(t){s=t.toJSON(),s.isSignedIn=r.appContext.getViewer().signedIn,s.isLoggedInUsersPhoto=r.isLoggedInUsersPhoto(),s.enabledEditableComments=!0,s.isOnMobile=r.isOnMobile,s.canCommentBeDeleted=!0,s.commentBelongsToViewer=!0,s.canComment=!0,s.enabledNewPro=this.appContext.flipper.isFlipped("enable-pro-badge"),r.get("container").one(".new-comment-text").set("value",""),r.get("container").one(".new-comment-text").setStyle("height","80px"),i=e.Node.create(r.templates("sub-photo-comment")(s)).setStyle("opacity","0.1"),a>0?r.get("container").one(".comments").append(i).one("li:last-child").transition({easing:"ease-in",duration:.5,opacity:"1"}):(r.get("container").one(".comments-holder").prepend("<ul class='comments'></ul>"),r.get("container").one(".comments").append(i).one("li:first-child").transition({easing:"ease-in",duration:.5,opacity:"1"})),r.retinafyCommentImages(),o=r.photoComments.getValue("comments").prependToList(t),u=r.photoEngagement.getValue("commentCount")+1,r.photoEngagement.setValue("commentCount",u),r.currentlyShowingCount++,r.fire("newCommentAdded"),r.fire("subviewViewEvent","newCommentAdded"),r.postingComment=!1,r.get("container")&&r.get("container").one("button.comment")&&r.get("container").one("button.comment").focus()},function(e){e.code===409?r.onError(r.intlMessage({intlName:"photo-page-scrappy.COMMENT_RATE_LIMIT_ERROR"})):e.code===8?r.onError(r.intlMessage({intlName:"photo-page-scrappy.EMPTY_COMMENT_ERROR"})):r.onError(r.intlMessage({intlName:"photo-page-scrappy.COMMENT_POST_ERROR"})),r.postingComment=!1}).then(null,function(e){n.error({err:e})})},handleMoreCommentsClick:function(e){e.preventDefault();var t=this,r=this.get("container"),i="",s=r.one(".comments-more"),o;s.one("a").set("text",this.intlMessage({intlName:"common.LOADING"})),s.addClass("is-loading"),this.appContext.getModel("photo-comments-models",this.photoId).then(function(e){e.getValue("comments").getRange({offset:t.currentlyShowingCount,limit:t.calculateShowMoreCount()}).then(function(e){var n;e=e.reverse();for(n=0;n<e.length;n++)o=e[n].toJSON(),o.isSignedIn=t.appContext.getViewer().signedIn,o.isOnMobile=t.isOnMobile,o.isLoggedInUsersPhoto=t.isLoggedInUsersPhoto(),o.canCommentBeDeleted=t.canCommentBeDeleted(o.author.nsid),o.commentBelongsToViewer=t.commentBelongsToViewer(o.author.nsid),o.enabledEditableComments=!0,o.canComment=t.photoModel.getValue("canComment"),o.enabledNewPro=t.appContext.flipper.isFlipped("enable-pro-badge"),i+=t.templates("sub-photo-comment")(o);r.one(".comments").prepend(i),t.retinafyCommentImages(),t.currentlyShowingCount=t.currentlyShowingCount+e.length,t.calculateShowMoreCount()>0?(t.calculateShowMoreCount()===1?s.one("a").set("text",t.intlMessage({intlName:"photo-page-scrappy.VIEW_PREVIOUS_COMMENT"})):s.one("a").set("text",t.intlMessage({intlName:"photo-page-scrappy.VIEW_MORE_PREVIOUS_COMMENTS",count:t.calculateShowMoreCount()})),s.removeClass("is-loading")):s.remove(),t.setViewDataOnHistory("numberOfCommentsShowing",t.currentlyShowingCount)},function(e){t.onError(t.intlMessage({intlName:"photo-page-scrappy.MORE_COMMENTS_ERROR"}))}).then(null,function(e){n.error({err:e})})})},calculateShowMoreCount:function(){var e=this.photoEngagement.getValue("commentCount");return e>this.currentlyShowingCount+this.showMoreMaximum?this.showMoreMaximum:e<=this.currentlyShowingCount+this.showMoreMaximum?e-this.currentlyShowingCount:0},isLoggedInUsersPhoto:function(){return this.photoModel.getValue("owner").getValue("nsid")===this.appContext.getViewer().nsid},canCommentBeDeleted:function(e){return e===this.appContext.getViewer().nsid||this.isLoggedInUsersPhoto()},commentBelongsToViewer:function(e){return e===this.appContext.getViewer().nsid},jumpToPermalinkedComment:function(){var t=e.config.win.location.hash,n=this.get("container"),r,i=10,s,o=this,u;r=parseInt(e.one(".global-nav-view").getStyle("height"),10)||0,t==="#comments"?(this.get("container").scrollIntoView(!0),e.config.win.scrollBy(0,-1*(r+i))):(s=n.one(t),s?(s.scrollIntoView(!0),e.config.win.scrollBy(0,-1*(r+i)),s.addClass("permalinked-comment")):(u=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.OOPS"}),message:o.intlMessage({intlName:"photo-page-scrappy.COMMENT_PERMALINK_ERROR"}),actionButtonLabel:o.intlMessage({intlName:"common.OK"}),classList:"scrappy-dialog"
,showCancelButton:!1,showActionButton:!0,showFooter:!1,dismissOnOverlayClick:!0}),u.show()))},retinafyCommentImages:function(){if(!YUI.Env.isServer&&this.appContext.getCookie("density")>1){var t=e.all(".comments li .comment-content a[data-photo-size-m]");t.each(function(e){e.one("img").setAttribute("src",e.getAttribute("data-photo-size-m")),e.removeAttribute("data-photo-size-m")})}},handleCommentKeyDown:function(e){if(e.charCode===9)return!0;var t=this,n=this.get("container").one(".new-comment-text"),r=n.get("value"),i=this.get("container").one(".false-comment-content"),s,o=this.get("container").one("button.comment");if(e.charCode===13&&(e.ctrlKey||e.metaKey)&&!this.postingComment){e.preventDefault();if(!this.appContext.getViewer().signedIn&&this.signedOutCommenting)return this.showSignUpModal();this.postingComment=!0,this.postComment(r),o.focus(),this.hideCommentButtonAfterComment||o.setStyle("display","none");return}e.which===9&&(e.preventDefault(),o.focus()),setTimeout(function(){i.set("value",n.get("value")),s=i._node.scrollHeight<t.textAreaMinHeight?t.textAreaMinHeight:i._node.scrollHeight,s=i._node.scrollHeight>t.textAreaMaxHeight?t.textAreaMaxHeight:s,n.setStyle("height",s+"px"),n.setStyle("minHeight","80px")},10)},handleCommentButtonClick:function(e){var t=this.get("container").one(".new-comment-text"),n=t.get("value");if(!this.postingComment){e.preventDefault();if(!this.appContext.getViewer().signedIn&&this.signedOutCommenting)return this.showSignUpModal();this.postingComment=!0,this.postComment(n),this.hideCommentButtonAfterComment||this.get("container").one("button.comment").setStyle("display","none");return}},handleDoneEditingCommentClick:function(t){t.preventDefault();var n=this,r=t.target.ancestor(".comment"),i,s,o=t.target.getAttribute("data-id"),u;n.appContext.getModel("comment-models",o).then(function(t){u=r.one("textarea");if(e.Lang.trim(u.get("value"))===""){n.onError(n.intlMessage({intlName:"photo-page-scrappy.EMPTY_COMMENT_ERROR"}));return}n.postingEditedComment=!0,t.setValues({content:u.get("value")}),n.appContext.modelRegistries["comment-models"].remoteUpdate(o).then(function(o){o?s=o.toJSON():s=t.toJSON(),s.isSignedIn=n.appContext.getViewer().signedIn,s.isLoggedInUsersPhoto=n.isLoggedInUsersPhoto(),s.enabledEditableComments=!0,s.canCommentBeDeleted=!0,s.commentBelongsToViewer=!0,s.canComment=n.photoModel.getValue("canComment"),s.isTooltipComment=n.isTooltipComments,s.ellipsis=n.ellipsis,s.isOnMobile=n.isOnMobile,s.enabledNewPro=n.appContext.flipper.isFlipped("enable-pro-badge"),i=e.Node.create(n.templates("sub-photo-comment")(s)),r.replace(i),n.fire("commentEdited"),n.postingEditedComment=!1},function(e){n.postingEditedComment=!1,t.revertValue("content"),n.onError(e.message)})})},handleReplyClick:function(t){t.preventDefault();var n=this.get("container").one("textarea"),r=n.get("value"),i="",s=n.getDOMNode(),o;r.length>0&&(i+=r+" "),i+="["+e.url("/photos/"+t.target.getAttribute("data-pathalias"))+"] ",s.setSelectionRange?(s.focus(),s.setSelectionRange(s.value.length,s.value.length)):s.createTextRange&&(o=s.createTextRange(),o.collapse(!0),o.moveEnd("character",s.value.length),o.moveStart("character",s.value.length),o.select()),n.focus(),n.set("value",i),s.scrollTop=s.scrollHeight},handleEditClick:function(t){t.preventDefault();var n=this,r=t.target.ancestor(".comment"),i=t.target.getAttribute("data-id"),s,o,u,a=this.get("container").one(".false-comment-content"),f;r.addClass("editing");if(r.one("textarea")){r.one("textarea").remove(),r.one(".comment-content").show();return}n.appContext.getModel("comment-models",i).then(function(t){r.one(".comment-content").hide(),r.append("<textarea>"+t.getValue("contentRaw")+"</textarea>"),r.append("<button class='ui-button ui-button-cta done-editing-comment' data-id='"+i+"' data-action='saveEdit'>"+n.intlMessage({intlName:"common.DONE"})+"</button>"),s=r.one("textarea"),a.set("value",s.get("value")),f=a._node.scrollHeight<n.textAreaMinHeight?n.textAreaMinHeight:a._node.scrollHeight,f=a._node.scrollHeight>n.textAreaMaxHeight?n.textAreaMaxHeight:f,s.setStyle("height",f+"px"),s.select(),s.on("keydown",function(l){setTimeout(function(){a.set("value",s.get("value")),f=a._node.scrollHeight<n.textAreaMinHeight?n.textAreaMinHeight:a._node.scrollHeight,f=a._node.scrollHeight>n.textAreaMaxHeight?n.textAreaMaxHeight:f,s.setStyle("height",f+"px")},10);if(l.charCode===13&&(l.ctrlKey||l.metaKey)&&!n.postingEditedComment){l.preventDefault();if(e.Lang.trim(s.get("value"))===""){n.onError(n.intlMessage({intlName:"photo-page-scrappy.EMPTY_COMMENT_ERROR"}));return}n.postingEditedComment=!0,t.setValues({content:s.get("value")}),n.appContext.modelRegistries["comment-models"].remoteUpdate(i).then(function(i){i?u=i.toJSON():u=t.toJSON(),u.isSignedIn=n.appContext.getViewer().signedIn,u.isLoggedInUsersPhoto=n.isLoggedInUsersPhoto(),u.enabledEditableComments=!0,u.canCommentBeDeleted=!0,u.commentBelongsToViewer=!0,u.canComment=n.photoModel.getValue("canComment"),u.isTooltipComment=n.isTooltipComments,u.ellipsis=n.ellipsis,u.isOnMobile=n.isOnMobile,u.enabledNewPro=n.appContext.flipper.isFlipped("enable-pro-badge"),o=e.Node.create(n.templates("sub-photo-comment")(u)),r.replace(o),n.fire("commentEdited"),n.postingEditedComment=!1},function(e){n.postingEditedComment=!1,t.revertValue("content"),n.onError(e.message)})}})})},handleDeleteClick:function(t){t.preventDefault();var r=this,i,s=t.target.ancestor(".comment"),o=t.target.getAttribute("data-id"),u;i=new e.Views.FluidModal({title:this.intlMessage({intlName:"photo-page-scrappy.DELETE_COMMENT"}),actionButtonLabel:this.intlMessage({intlName:"common.DELETE"}),htmlMessage:this.intlMessage({intlName:"photo-page-scrappy.COMMENT_DELETE_CONFIRMATION"}),appContext:this.appContext,classList:"scrappy-dialog",dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!0,hideModalOverlay:!1,showCancelX:!0}),i.on("actionClick",function(e){r.appContext.modelRegistries["comment-models"].remoteDelete
(o).then(function(){r.photoComments.getValue("comments").removeFromList(o),u=r.photoEngagement.getValue("commentCount")-1,r.photoEngagement.setValue("commentCount",u),r.currentlyShowingCount--,r.fire("commentDeleted"),s.transition({easing:"ease-out",duration:.5,opacity:"0"},function(){s.remove(),u===0&&r.get("container").one(".comments").remove()})},function(e){r.onError(r.intlMessage({intlName:"photo-page-scrappy.COMMENT_DELETE_ERROR"}))}).then(null,function(e){n.error({err:e})})}),i.show()},showSignUpModal:function(){var t=e.config.win.location.href,n=this.intlMessage({intlName:"comments.SIGNUP_MODAL_TITLE"}),r=this.intlMessage({intlName:"comments.SIGNUP_MODAL_MESSAGE"}),i;e.StorageHelper.setItem("pendingComment-"+this.photoId,this.get("container").one(".new-comment-text").get("value")),i=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"",signUpTitle:n,signUpMessage:r,beaconPrefix:"comment"}),i.on("signUpClick",function(n){e.SigninHelper._redirectToSignUp("",{postLoginUrl:t})}),i.on("signInClick",function(n){e.SigninHelper._redirectToSignin("",{postLoginUrl:t})}),i.show()},onError:function(t){var n;if(this.isTooltipComments)return;n=new e.Views.FluidModal({title:this.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),htmlMessage:t,appContext:this.appContext,classList:"scrappy-dialog",dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!0,hideModalOverlay:!1,showCancelX:!0}),n.show()}})},"@VERSION@",{requires:["flickr-view","moment","fluid-modal-view","signup-modal-view","hermes-template-comments","hermes-template-sub-photo-comment","hermes-template-sub-photo-comments-view","url","signin-helper","storage-helper"],langBundles:["common","comments","photo-page-scrappy","relative-dates"],optional:["photo-comments-models"]});
YUI.add("hermes-template-preview-photo",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return"with-group-attribution"},3:function(e,t,n,r,i){return"hide-overlays"},5:function(e,t,n,r,i){return"preview-is-video"},7:function(e,t,n,r,i){var s;return(s=e.invokePartial(r["feed-card-attribution"],t,{name:"feed-card-attribution",hash:{hideContextMenu:true,menuType:t!=null?t.menuType:t,curated:t!=null?t.curated:t,recommended:t!=null?t.recommended:t,time:t!=null?t.time:t,blockingAds:t!=null?t.blockingAds:t,isAd:t!=null?t.isAd:t,owner:(s=t!=null?t.photo:t)!=null?s.owner:s},data:i,indent:"				",helpers:n,partials:r,decorators:e.decorators}))!=null?s:""},9:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.curated:t,{name:"if",hash:{},fn:e.program(10,i,0),inverse:e.program(12,i,0),data:i}))!=null?s:""},10:function(e,t,n,r,i){var s;return(s=e.invokePartial(r["feed-card-attribution"],t,{name:"feed-card-attribution",hash:{hideContextMenu:true,menuType:t!=null?t.menuType:t,curated:t!=null?t.curated:t,recommended:t!=null?t.recommended:t,time:t!=null?t.time:t,blockingAds:t!=null?t.blockingAds:t,isAd:t!=null?t.isAd:t,owner:(s=t!=null?t.photo:t)!=null?s.owner:s},data:i,indent:"					",helpers:n,partials:r,decorators:e.decorators}))!=null?s:""},12:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.groupId:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(15,i,0),data:i}))!=null?s:""},13:function(e,t,n,r,i){var s;return(s=e.invokePartial(r["feed-card-attribution"],t,{name:"feed-card-attribution",hash:{hideContextMenu:true,groupContextOnly:true,iconUrl:t!=null?t.iconUrl:t,groupName:t!=null?t.groupName:t,menuType:t!=null?t.menuType:t,curated:t!=null?t.curated:t,recommended:t!=null?t.recommended:t,time:t!=null?t.time:t,blockingAds:t!=null?t.blockingAds:t,isAd:t!=null?t.isAd:t,owner:(s=t!=null?t.photo:t)!=null?s.owner:s},data:i,indent:"						",helpers:n,partials:r,decorators:e.decorators}))!=null?s:""},15:function(e,t,n,r,i){var s;return(s=e.invokePartial(r["feed-card-attribution"],t,{name:"feed-card-attribution",hash:{hideContextMenu:true,isGroup:false,menuType:t!=null?t.menuType:t,curated:t!=null?t.curated:t,recommended:t!=null?t.recommended:t,time:t!=null?t.time:t,blockingAds:t!=null?t.blockingAds:t,isAd:t!=null?t.isAd:t,owner:(s=t!=null?t.photo:t)!=null?s.owner:s},data:i,indent:"						",helpers:n,partials:r,decorators:e.decorators}))!=null?s:""},17:function(e,t,n,r,i){var s,o,u=e.escapeExpression;return'			<a href="'+u((o=(o=n.url||(t!=null?t.url:t))!=null?o:n.helperMissing,typeof o=="function"?o.call(t!=null?t:{},{name:"url",hash:{},data:i}):o))+'" title="'+u(e.lambda((s=t!=null?t.photo:t)!=null?s.title:s,t))+'" class="preview-inappropriate-link">\n'+((s=e.invokePartial(r["adult-content-overlay"],t,{name:"adult-content-overlay",hash:{h_unit:"px",height:(s=t!=null?t.displayPhoto:t)!=null?s.height:s,w_unit:"px",width:(s=t!=null?t.displayPhoto:t)!=null?s.width:s},data:i,indent:"				",helpers:n,partials:r,decorators:e.decorators}))!=null?s:"")+"			</a>\n"},19:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},(s=t!=null?t.photo:t)!=null?s.isVideo:s,{name:"if",hash:{},fn:e.program(20,i,0),inverse:e.program(22,i,0),data:i}))!=null?s:""},20:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression,c=e.lambda;return'				<div class="videoplayer">\n					<a href="'+l((o=(o=n.url||(t!=null?t.url:t))!=null?o:a,typeof o===f?o.call(u,{name:"url",hash:{},data:i}):o))+'" title="'+l(c((s=t!=null?t.photo:t)!=null?s.title:s,t))+'" class="preview-video-link">\n						<span class="facade-of-protection-neue"></span>\n						<video id="video_1" poster="'+l((o=(o=n.src||(t!=null?t.src:t))!=null?o:a,typeof o===f?o.call(u,{name:"src",hash:{},data:i}):o))+'" class="video-js vjs-big-play-centered" style="max-height: '+l(c((s=t!=null?t.displayPhoto:t)!=null?s.height:s,t))+"px; max-width:"+l(c((s=t!=null?t.displayPhoto:t)!=null?s.width:s,t))+'px;"></video>\n					</a>\n				</div>\n'},22:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression,c=e.lambda;return'				<a href="'+l((o=(o=n.url||(t!=null?t.url:t))!=null?o:a,typeof o===f?o.call(u,{name:"url",hash:{},data:i}):o))+'" title="'+l(c((s=t!=null?t.photo:t)!=null?s.title:s,t))+'" class="preview-img-link">\n					<span class="facade-of-protection-neue"></span>\n					<img src="'+l((o=(o=n.spaceball||(t!=null?t.spaceball:t))!=null?o:a,typeof o===f?o.call(u,{name:"spaceball",hash:{},data:i}):o))+'" class="low-res-img '+((s=n["if"].call(u,t!=null?t.urlDisplayedOnFeed:t,{name:"if",hash:{},fn:e.program(23,i,0),inverse:e.noop,data:i}))!=null?s:"")+'"  style="height: '+l(c((s=t!=null?t.displayPhoto:t)!=null?s.height:s,t))+"px; width:"+l(c((s=t!=null?t.displayPhoto:t)!=null?s.width:s,t))+'px;" />\n					<img src="'+l((o=(o=n.spaceball||(t!=null?t.spaceball:t))!=null?o:a,typeof o===f?o.call(u,{name:"spaceball",hash:{},data:i}):o))+'" class="high-res-img hidden '+((s=n["if"].call(u,t!=null?t.urlDisplayedOnFeed:t,{name:"if",hash:{},fn:e.program(25,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" style="max-height: '+l(c((s=t!=null?t.displayPhoto:t)!=null?s.height:s,t))+"px; max-width:"+l(c((s=t!=null?t.displayPhoto:t)!=null?s.width:s,t))+"px; margin-left: calc(-"+l(c((s=t!=null?t.displayPhoto:t)!=null?s.width:s,t))+"px/2);margin-top:calc(-"+l(c((s=t!=null?t.displayPhoto:t)!=null?s.height:s,t))+'px/2)"/>\n				</a>\n'},23:function(e,t,n,r,i){return"no-blur"},25:function(e,t,n,r,i){return"no-animation"},27:function(e,t,n,r,i){return"is-video"},29:function(e,t,n,r,i){var s,o,u=t!=null?t:{};return'					<p class="title '+((s=n["if"].call(u,(s=t!=null?t.photo:t)!=null?s.description:s,{name:"if",hash:{},fn:e.noop,inverse:e.program(30,i,0),data:i}))!=null?s:"")+'">\n						'+e.escapeExpression((o=(o=n.title||(t!=null?t.title:t))!=null?o:n.helperMissing,typeof o=="function"?o.call(u,{name:"title",hash:{},data:i}):o))+"\n					</p>\n"},30:function(e,t,n,r,i){return"no-description"
},32:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f=e.escapeExpression;return'					<div class="description '+((s=n["if"].call(u,t!=null?t.title:t,{name:"if",hash:{},fn:e.noop,inverse:e.program(33,i,0),data:i}))!=null?s:"")+'">\n						 '+f((n.photoDescription||t&&t.photoDescription||a).call(u,(n.stripTags||t&&t.stripTags||a).call(u,t!=null?t.description:t,{name:"stripTags",hash:{},data:i}),!0,{name:"photoDescription",hash:{},data:i}))+'\n\n						<a class="read-more" href="'+f((o=(o=n.url||(t!=null?t.url:t))!=null?o:a,typeof o=="function"?o.call(u,{name:"url",hash:{},data:i}):o))+'">'+((s=n["if"].call(u,t!=null?t.readMore:t,{name:"if",hash:{},fn:e.program(35,i,0),inverse:e.noop,data:i}))!=null?s:"")+"</a>\n					</div>\n"},33:function(e,t,n,r,i){return"no-title"},35:function(e,t,n,r,i){return" "+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"feed.READ_MORE"},data:i}))+" "},37:function(e,t,n,r,i){var s;return(s=e.invokePartial(r["feed-card-engagement-actions"],t,{name:"feed-card-engagement-actions",hash:{"preview-inline-counts":true},data:i,indent:"					",helpers:n,partials:r,decorators:e.decorators}))!=null?s:""},39:function(e,t,n,r,i){var s;return'	<a class="navigate prev-photo" href="'+e.escapeExpression(e.lambda((s=t!=null?t.prevPhoto:t)!=null?s.url:s,t))+'">\n		<div class="nav-photo-image">\n			<div class="prev-arrow-icon">\n			</div>\n		</div>\n	</a>\n'},41:function(e,t,n,r,i){var s;return'	<a class="navigate next-photo" href="'+e.escapeExpression(e.lambda((s=t!=null?t.nextPhoto:t)!=null?s.url:s,t))+'">\n		<div class="nav-photo-image">\n			<div class="next-arrow-icon">\n			</div>\n		</div>\n	</a>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression,c=e.lambda;return'<div class="pagination '+((s=n["if"].call(u,t!=null?t.groupId:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n	<p>'+l((o=(o=n.index||(t!=null?t.index:t))!=null?o:a,typeof o===f?o.call(u,{name:"index",hash:{},data:i}):o))+" / "+l((o=(o=n.total||(t!=null?t.total:t))!=null?o:a,typeof o===f?o.call(u,{name:"total",hash:{},data:i}):o))+'</p>\n</div>\n<div class="preview-content '+((s=n["if"].call(u,t!=null?t.isNavigating:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" style="max-width: '+l(c((s=t!=null?t.displayPhoto:t)!=null?s.width:s,t))+'px;">\n	<div class="preview-photo '+((s=n["if"].call(u,(s=t!=null?t.photo:t)!=null?s.isVideo:s,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" style="width: '+l(c((s=t!=null?t.displayPhoto:t)!=null?s.width:s,t))+"px; height: "+l(c((s=t!=null?t.displayPhoto:t)!=null?s.height:s,t))+'px;">\n		<div class="attribution">\n'+((s=n["if"].call(u,t!=null?t.recommended:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+"		</div>\n"+((s=n["if"].call(u,t!=null?t.isInappropriate:t,{name:"if",hash:{},fn:e.program(17,i,0),inverse:e.program(19,i,0),data:i}))!=null?s:"")+'		<div class="preview-metadata '+((s=n["if"].call(u,(s=t!=null?t.photo:t)!=null?s.isVideo:s,{name:"if",hash:{},fn:e.program(27,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n			<div class="title-and-description">\n'+((s=n["if"].call(u,t!=null?t.title:t,{name:"if",hash:{},fn:e.program(29,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"+((s=n["if"].call(u,(s=t!=null?t.photo:t)!=null?s.description:s,{name:"if",hash:{},fn:e.program(32,i,0),inverse:e.noop,data:i}))!=null?s:"")+'			</div>\n			<div class="engagement feed-card-actions on-preview">\n'+((s=n["if"].call(u,t!=null?t.isInappropriate:t,{name:"if",hash:{},fn:e.noop,inverse:e.program(37,i,0),data:i}))!=null?s:"")+"			</div>\n		</div>\n	</div>\n</div>\n\n"+((s=n["if"].call(u,t!=null?t.prevPhoto:t,{name:"if",hash:{},fn:e.program(39,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(u,t!=null?t.showNextPhotoLink:t,{name:"if",hash:{},fn:e.program(41,i,0),inverse:e.noop,data:i}))!=null?s:"")},usePartial:!0,useData:!0}),r={};e.Array.each(["feed-card-attribution","feed-card-attribution","feed-card-attribution","feed-card-attribution","adult-content-overlay","feed-card-engagement-actions"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/preview-photo",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-feed-card-attribution","hermes-template-feed-card-attribution","hermes-template-feed-card-attribution","hermes-template-feed-card-attribution","hermes-template-adult-content-overlay","hermes-template-feed-card-engagement-actions"]});
YUI.add("flickr-video-player",function(e,t){var n=require("lib/flog")(t),r={playlistUrl:e.url("/video_playlist.gne",{protocol:!1}),lang:e.config.lang,comscoreC4:"",defaultResolution:"1080p",qualities:["1080p","720p","appletv","360p","700","300","100","iphone_wifi","288p"],atlas:{maxBitrate:4e3,domain:"video.yahoo.com"},css:{processing:"processing"},messages:{processing:"This video is being processed"}};e.FlickrVideoPlayer=function(e){this.container=e.container,this.model=e.model,this.appContext=e.appContext,this.currentStream=null,this.videoNode=e.videoNode,this.showControls=typeof e.showControls!="undefined"?e.showControls:!0,this.autoplay=e.autoplay||!1,this.loop=e.loop||!1,this.muted=e.muted||!1,this.inactivityTimeout=e.inactivityTimeout||undefined,this.controlBar=e.controlBar||{}},e.FlickrVideoPlayer.prototype={render:function(){var t,n,i=this;this.setCurrentStream(r.defaultResolution,"noop");if(this.player)return this.player.on("error",function(){var t=i.player.error();e.config.win.beaconError&&e.config.win.beaconError("[HTML5 Video Player] A stream could not be played: Code "+t.code+" - "+t.message,e.config.win.location.href,t);var n=r.qualities.indexOf(i.currentStream.resolution);if(n<r.qualities.length-1){var s=r.qualities[n+1];i.setCurrentStream(s,"noop"),i.player.src(i.currentStream.url)}}),this.player.on("loadeddata",function(){e.config.win.beaconError&&e.config.win.beaconError("[HTML5 Video Player] Data load time in ms",e.config.win.location.href,{loadTime:Math.abs((new Date).getTime()-i.sourceSetTimestamp.getTime())})}),this.player.on("waiting",function(){i.waitStartTimestamp=new Date}),this.player.on("readystatechange",function(){i.waitStartTimestamp&&i.player.readyState()>=3&&(e.config.win.beaconError&&e.config.win.beaconError("[HTML5 Video Player] Playback wait time in ms",e.config.win.location.href,{waitTime:Math.abs((new Date).getTime()-i.waitStartTimestamp.getTime())}),i.waitStartTimestamp=0)}),this.player.src(this.currentStream.url),this.sourceSetTimestamp=new Date,this},play:function(){this.player&&this.player.play()},pause:function(){this.player&&this.player.pause()},resize:function(e,t){this.container.setStyles({width:e+"px",height:t+"px"})},setCurrentStream:function(e,t){this.currentStream&&this.quality&&this.quality.removeClass("q"+this.currentStream.resolution),this.currentStream=this.getStream(e,!1),this.quality&&this.quality.addClass("q"+this.currentStream.resolution);if(t)return;this.player.playlist.clear(),this.player.playlist.addItem(this.toMediaItem(this.currentStream)),this.player.playlist.setPosition(0)},toMediaItem:function(e){return{streamUrl:e.url,images:this.getThumbnails()}},init:function(){var t,n=this;return t=new e.FlickrPromise({streams:this.loadStreams(),domLive:this._waitDomLive()}),t.then(function(e){return n.loadScript().then(function(){n.isProcessing||n.render()})},function(e){console.warn("Error:"+e)})},_waitDomLive:function(){var t=this;return new e.Promise(function(e,n){var r=50,i;i=function(){if(t.container){var n=t.container.getDOMNode().parentElement,s=n.parentElement;while(s&&s!==document.body)s=s.parentElement;if(s)return e();if(r--<0)return}setTimeout(i,100)},i()})},getStream:function(e,t){var n=r.qualities.slice(0),i,s;e&&(s=n.indexOf(e)+(t?1:0),n=s>0?n.slice(s):n);while(n.length){i=this.streams[n.shift()];if(i)return i}return this.showErrorMessage(),{}},showErrorMessage:function(){e.one(".vjs-modal-dialog").addClass("show"),e.config.win.beaconError&&e.config.win.beaconError("[HTML5 Video Player] No playable streams",e.config.win.location.href)},getThumbnails:function(){var e,t;return this.container?t={width:parseInt(this.container.getComputedStyle("width"),10)||800,height:parseInt(this.container.getComputedStyle("height"),10)||600}:t={width:800,height:800},e=this.model.getSizeToFit(t,{excludeSizes:[]}),{large:e.url,medium:e.url,small:e.url}},loadScript:function(){var t=this;return new e.Promise(function(n,r){var i,s;if(e.VideoPlatform){n();return}t.isProcessing||e.use("videojs",function(){window.videojs(t.videoNode,{controls:t.showControls,poster:t.getThumbnails().large,autoplay:t.autoplay,loop:t.loop,muted:t.muted,inactivityTimeout:t.inactivityTimeout,controlBar:t.controlBar},function(){t.player=this,n()})})})},loadStreams:function(){var t=this;return new e.Promise(function(e,r){var i;i={photo_id:t.model.getValue("id"),secret:t.model.getValue("secret")},t.appContext.callAPI("flickr.video.getStreamInfo",i).then(function(r){try{t.streams=r.streams.stream.reduce(function(e,t){var n=t.type+"";return e[n]={resolution:n,url:t.content},e},{})}catch(i){t.streams={}}Object.keys(t.streams).length||n.error("no streams available"),e()},function(e){if(e&&e.code&&e.code.toString()==="1")return t.setProcessing();n.error("error fetching playlist")})})},_cleanup:function(e){e=e.getDOMNode();var t=function(e){if(!e.firstChild)return;while(e.firstChild)t(e.firstChild),e.removeChild(e.firstChild)};t(e)},setProcessing:function(){this.isProcessing=!0,this.videoNode.style.display="none";var t=e.Node.create("<img/>");t.set("src",this.getThumbnails().large),this.container.appendChild(t)},destroy:function(){var e=this;try{if(window.videojs&&window.videojs.getPlayers){var t=window.videojs.getPlayers();Object.keys(t).forEach(function(n){t[n]===e.player&&(t[n].dispose(),window.videojs.players[n]&&delete window.videojs.players[n])})}this.player&&this.player.destroy&&this.player.destroy(),this.player=null,this.quality&&this.quality.detach(),this.quality=null,this._cleanup(this.container),this.container=null,this.model=null,this.appContext=null,this.streams=null}catch(n){}}}},"@VERSION@",{requires:["flickr-promise","flutil","url"],optional:[]});
YUI.add("photo-privacy-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,n){var r;return r={photo_id:t,is_public:this.getValue(t,"isPublic"),is_friend:this.getValue(t,"isVisibleByFriends"),is_family:this.getValue(t,"isVisibleByFamily"),perm_addmeta:this.getValue(t,"permAddMeta"),perm_comment:this.getValue(t,"permComment")},e.ModelUpdaters["flickr-photos-setPerms"].run(r,this.appContext)},batchUpdate:function(t,n){var r;switch(!0){case"privacy"in n&&"commenting"in n&&"addMeta"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily,perm_addmeta:n.addMeta,perm_comment:n.commenting};break;case"privacy"in n&&"commenting"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily,perm_comment:n.commenting};break;case"privacy"in n&&"addMeta"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily,perm_addmeta:n.addMeta};break;case"commenting"in n&&"addMeta"in n:r={photo_ids:t,perm_addmeta:n.addMeta,perm_comment:n.commenting};break;case"privacy"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily};break;case"commenting"in n:r={photo_ids:t,perm_comment:n.commenting};break;case"addMeta"in n:r={photo_ids:t,perm_addmeta:n.addMeta}}return r.full_response=1,e.ModelUpdaters["flickr-photos-setPerms"].run(r,this.appContext)}},attributes:{isPublic:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFriends:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},permAddMeta:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},permComment:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getPerms-fetcher","flickr-photos-setPerms-updater","attribute-helpers"]});
YUI.add("flickr-photos-getPerms-fetcher",function(e,t){"use strict";function n(e,t){var n=e[0],r=e[1],i;i={id:t.id,isPublic:n.perms.ispublic,isVisibleByFriends:n.perms.isfriend,isVisibleByFamily:n.perms.isfamily,permAddMeta:n.perms.permaddmeta,permComment:n.perms.permcomment},r.addOrUpdate(i)}function r(n,r){var i=n.id,s={photo_id:i},o=this;return e.Promise.all([r.callAPI("flickr.photos.getPerms",s),r.getModelRegistry("photo-privacy-models")]).then(function(e){return o._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-photos-getPerms"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-privacy-models"]});
YUI.add("activity-model",function(e,t){function n(e){n.superclass.constructor.call(this,e)}e.Models[this.name]=n,e.extend(n,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{},attributes:{photos:{isCollection:!0},photoPrivacies:{isCollection:!0},time:{},count:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},photosCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},videosCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},recommended:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},curated:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},eventType:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},ownerId:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},groupId:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},groupName:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},recId:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},isDisabled:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},iconUrls:{}}},{})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-activity-getContactsPhotos-fetcher","flickr-activity-getBatchPhotos-fetcher","photo-model-helper"],langBundles:["models"]});
YUI.add("flickr-activity-getContactsPhotos-fetcher",function(e,t){"use strict";function n(e,t){var n={per_page:e.perPage||30,page:e.page||1,event_types:e.eventTypes,rec_pos:12,extras:"all_sizes,icon_urls_deep",get_user_info:1,per_batch:e.perBatch||5};return e.invalidate&&(n.invalidate=(new Date).getTime()),n}function r(t,n,r,i){var s=t[0].photos,o=t[1],u=t[2],a=t[3],f=t[4],l=t[5],c=t[6],h=t[7],p={id:r.id,totalItems:s.total},d=[];return s.photo.forEach(function(t){var n={},r;if(t.count>0){n.isDisabled=!1,n.time=t.time,n.iconUrls=t.iconurls,n.id=t.batchid,n.recommended=t.recommended,n.curated=t.curated,n.eventType=t.eventType||"UploadBatch",n.count=t.count,n.videosCount=parseInt(t.countVideo,10)||0,n.photosCount=parseInt(t.countPhoto,10)||0,t.eventType==="GroupBatch"?(n.groupId=t.owner,n.groupName=t.ownername):t.eventType==="Flickrec"?n.recId=t.photos[0].recommendation_id:n.ownerId=t.owner,r=e.APIHelper.response.parsePhotos({photos:t.photos,personModelRegistry:f,photoModelRegistry:a,photoEngagementModelRegistry:l,photoStatsModelRegistry:c}),n.photos=r;var i=[];t.photos.forEach(function(e){var t={id:e.id,isPublic:e.ispublic,isVisibleByFriends:e.isfriend,isVisibleByFamily:e.isfamily};i.push(h.addOrUpdate(t))}),n.photoPrivacies=i,d.push(u.addOrUpdate(n))}}),p.activityList={perPage:s.perPage,page:s.page||1,pageContent:d,totalItems:s.total,totalPages:s.pages},o.addOrUpdate(p),p.activityList.pageContent}function i(r,i){var s=this,o=n(r,i);return e.Promise.all([i.callAPI("flickr.activity.getContactsPhotos",o,!0),i.getModelRegistry("activity-models"),i.getModelRegistry("activity-model"),i.getModelRegistry("photo-models"),i.getModelRegistry("person-models"),i.getModelRegistry("photo-engagement-models"),i.getModelRegistry("photo-stats-models"),i.getModelRegistry("photo-privacy-models")]).then(function(e){return s._processResponse(e,o,r,i)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-activity-getContactsPhotos"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["activity-models","activity-model","photo-models","person-models","photo-engagement-models","photo-stats-models","photo-privacy-models"]});
YUI.add("flickr-photos-recommendations-feedback-add-updater",function(e,t){"use strict";function n(n,r){var i={};return i.photo_id=n.photoId,i.rec_id=n.recId,r.callAPI("flickr.photos.recommendations.feedback.add",i).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-recommendations-feedback-add"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("activity-models",function(e,t){function n(e){n.superclass.constructor.call(this,e)}e.Models[this.name]=n,e.extend(n,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-activity-getContactsPhotos"].run(t,this.appContext)},updateRecommendedFeedback:function(t,n){return e.ModelUpdaters["flickr-photos-recommendations-feedback-add"].run(t,n)}},updateRecommendedFeedbackRemote:function(e,t,n){return this.remote.updateRecommendedFeedback.call(this,{recId:n,photoId:t},this.appContext)},readLastUpdateRemote:function(){return this.appContext.callAPI("flickr.activity.lastUpdate",{}).then(function(e){return e&&e.activity&&e.activity.lastUpdate?e.activity.lastUpdate:null})},insertUserPrefsRemote:function(e,t){return this.appContext.callAPI("flickr.feed.preferences.insertUserPreferences",t).then(function(e){return e},function(e){return e})},attributes:{activityList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-activity-getContactsPhotos"]}},totalItems:{defaultFn:function(){return null}}}},{})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-activity-getContactsPhotos-fetcher","flickr-photos-recommendations-feedback-add-updater","photo-model-helper"],langBundles:["models"]});
YUI.add("flickr-activity-getBatchPhotos-fetcher",function(e,t){"use strict";function r(t,r){var i={page:1,id:t.id,perPage:n,batch_id:t.id,per_page:n,extras:e.APIHelper.request.getRebootPhotoExtras()};return i}function i(t,n,r,i){var s=t[0].photos,o=t[1],u=t[1],a=t[2],f=t[3],l=t[4],c=t[5],h=s.photo,p={},d;p.time=undefined,p.iconUrls=undefined,p.id=n.id,p.recommended=undefined,p.curated=undefined,p.eventType=undefined,p.count=s.total,p.videosCount=undefined,p.photosCount=undefined,d=e.APIHelper.response.parsePhotos({photos:s.photo,personModelRegistry:a,photoModelRegistry:u,photoEngagementModelRegistry:f,photoStatsModelRegistry:l}),p.photos=d;var v=[];return p.photos.forEach(function(e){var t={id:e.id,isPublic:e.ispublic,isVisibleByFriends:e.isfriend,isVisibleByFamily:e.isfamily};v.push(c.addOrUpdate(t))}),p.photoPrivacies=v,o.addOrUpdate(p),p.photos}function s(t,n){var i=this,s=r(t,n);return e.Promise.all([n.callAPI("flickr.activity.getBatchPhotos",s,!0),n.getModelRegistry("activity-model",s.id),n.getModelRegistry("photo-models"),n.getModelRegistry("person-models"),n.getModelRegistry("photo-engagement-models"),n.getModelRegistry("photo-stats-models"),n.getModelRegistry("photo-privacy-models")]).then(function(e){return i._processResponse(e,s,t,n)},function(e){console.log("Error",e)})}var n=100;e.namespace("ListFetchers")["flickr-activity-getBatchPhotos"]={run:s,_processParams:r,_processResponse:i}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["activity-models","activity-model","photo-models","person-models","photo-engagement-models","photo-stats-models","photo-privacy-models"]});
YUI.add("seo",function(e,t){e.Seo={appContext:{},stripTags:function(e){return e?String(e).replace(/<\/?[^>]+>/g,""):""},collapseWhitespace:function(e){return e.trim().replace(/\s+/g," ")},decodeEntities:function(e){return e.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ")},cleanText:function(e){return this.collapseWhitespace(this.decodeEntities(this.stripTags(e)))},getSEOTitleForPhoto:function(e){var t=this.cleanText(e.getValue("title")),n=this.cleanText(e.getValue("description")),r=this.cleanText(e.getValue("owner").getValue("displayname")),i="",s="| Flickr",o=70,u=o-(t.length+s.length+5);return t.length>=50?i=t.slice(0,58)+(t.length<58?" ":"\u2026 "):t.length>20&&t.length<50?n.length>20?i=t+" | "+n.slice(0,u)+(n.length<u?" ":"\u2026 "):n.length>0?i=t+" | "+n.slice(0,u)+(n.length<u?" ":"\u2026 ")+"| "+r+" ":i=t+" | "+r+" ":t.length<=20&&t.length>0?n.length>50?i=t+" | "+n.slice(0,u)+(n.length<u?" ":"\u2026 "):n.length>0?i=t+" | "+n.slice(0,u)+(n.length<u?" ":"\u2026 ")+"| "+r+" ":i=t+" | "+r+" ":n.length>50?i=n.slice(0,u)+(n.length<u?" ":"\u2026 "):n.length>0?i=n.slice(0,u)+(n.length<u?" ":"\u2026 ")+"| "+r+" ":i="Untitled | "+r+" ",i},generateSEODescriptionForPhoto:function(e,t,n,r,i){var s=e.getValue("og:title"),o=e.getValue("og:description"),u="",a=160;return s==="Untitled"&&(s=r),o.length>120?u=o.slice(0,120)+(o.length<120?" ":"\u2026 ")+n+" "+i+".":o.length>60&&o.length<120?u=o+(o.slice(o.length-1,o.length)==="."?" ":". ")+s.slice(0,40)+(s.length<40?" ":"\u2026 ")+n+" "+i+".":o.length<=60&&(u=s+(s.slice(s.length-1,s.length)==="."?" ":". ")+o.slice(0,a-s.length)+(o.length<a-s.length?" ":"\u2026 ")+n+" "+i+"."),u}}},"@VERSION@",{requires:[]});
YUI.add("preview-activity-view",function(e,t){var n=require("lib/flog")(t),r=25;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.params=t,this.params.growTextFieldWhenTyping=!1,this.photoModel=t.photoModel,this.photoId=t.photoModel.getValue("id"),this.activityId=t.activityId,this.width=t.width,this.height=t.height,this.prevAndNextWidth=60,t.previewSpaceId&&this.set("spaceid",t.previewSpaceId),this.urlDisplayedOnFeed=t.urlDisplayedOnFeed,this.batchApiParams={page:1,perPage:r,batch_id:this.activityId,per_page:r,extras:e.APIHelper.request.getRebootPhotoExtras()},this.totalPages=0,this.isFetching=!1,this.safeSearch=t.safeSearch,this.isInitialPhoto=!0,this},loadState:function(){var e=this;return this.appContext.getModel("activity-model",this.activityId).then(function(t){var n=t.getValue("photos"),r=n.find(e.photoModel,!0)?n.find(e.photoModel,!0).index:0;return e.set("activity",t),e.set("photosList",n.getList()),e.set("currentPhotoIndex",r),e.setCurrentPhoto.call(e)})},buildContainer:function(t){this.player&&(this.player.destroy(),this.player=null);var n=this.get("currentPhoto"),r=this.appContext.getViewer().getPixelRatio()>1?1.5:1,i=this.getCanvasDimensions(),s=this.get("activity"),o=n.getSizeForCanvas(i.width*r,i.height*r,r),u=n.toJSON(),a=!1,f=this.getNextPhoto(),l=this.getPrevPhoto(),c=typeof s.getValue("groupId")!="undefined",h,p,d=!1,v,m,g,y;u.safetyLevel>this.safeSearch&&(a=!0);if(c){var b=s.getValue("iconUrls").default;b.indexOf("https")===-1&&(b=b.replace("http","https")),h=b}var w=n.getValue("url");s.getValue("groupId")?w+="/in/pool-"+s.getValue("groupId"):w+="/in/feed",p=e.Seo.stripTags(u.description),p.length>140&&(p=p.slice(0,140)+"&hellip;",d=!0),this.setContainerWithTemplate("preview-photo",{title:n.getValue("title").trim().length===0?!1:n.getValue("title"),viewPhotoPageLink:n.getValue("url"),width:o.width*r,height:o.height*r,displayPhoto:o,urlDisplayedOnFeed:this.urlDisplayedOnFeed,photo:u,groupName:s.getValue("groupName"),groupId:s.getValue("groupId"),url:w,description:p,readMore:d,iconUrl:h,viewsCount:u.engagement.viewCount,favesCount:u.engagement.faveCount,moreThan99Faves:u.engagement.faveCount>99,moreThan99Comments:u.engagement.commentCount>99,commentsCount:u.engagement.commentCount,showNextPhotoLink:this.get("currentPhotoIndex")+1<s.getValue("count"),nextPhoto:f,prevPhoto:l,index:this.get("currentPhotoIndex")+1,total:s.getValue("count"),recommended:s.getValue("recommended"),curated:s.getValue("curated")&&s.getValue("recommended"),time:s.getValue("time"),singlePhoto:s.getValue("count")===1,isInappropriate:a,isNavigating:t});if(!YUI.Env.isServer){this.setRapid();var E=e.one(".fluid-modal-overlay .balls");E&&E.remove(),n.getValue("isVideo")?(this.initVideo(),this.dismissOverlayTimeout.call(this)):(g=this.get("container").one(".high-res-img"),y=this.get("container").one(".low-res-img"),v=this.loadImage(o.url,function(e,t){g&&(t<=10&&g.addClass("unanimated"),g.setAttribute("src",e.src).removeClass("hidden"),y.addClass("hidden")),f&&this.loadImage(f.getSizeForCanvas(i.width*r,i.height*r,r).url),l&&this.loadImage(l.getSizeForCanvas(i.width*r,i.height*r,r).url),this.dismissOverlayTimeout.call(this)}.bind(this)),v.complete?g&&(g.setAttribute("src",v.src).addClass("unanimated").removeClass("hidden"),y.addClass("hidden")):window.CSS&&window.CSS.supports&&window.CSS.supports("(-webkit-filter: blur(1px)) or (filter: blur(1px))")&&g&&y&&(this.urlDisplayedOnFeed?m=this.urlDisplayedOnFeed:m=n.getSizeForCanvas(100,100,1).url,g.setAttribute("src",m),y.setAttribute("src",m))),this.isInitialPhoto?(history.pushState({},"",w),this.isInitialPhoto=!1):history.replaceState({},"",w),document&&(document.title=e.pageTitleHelper(e.Seo.getSEOTitleForPhoto(this.get("currentPhoto"))))}},activate:function(){var t=this.get("container"),n=this.get("activity"),r=n.getValue("photos").getList(),i=e.one(".fluid-modal-overlay");return this.registerEventHandler(t.delegate("click",this.onFullscreenButtonClick.bind(this),".vjs-fullscreen-control")),this.registerEventHandler(e.globalEvents.subscribe("document:fullscreenchange",this.toggleWindowResizeHandler.bind(this))),this.windowResize=e.globalEvents.subscribe("window:resize",this.onWindowResize.bind(this)),this.registerEventHandler(this.windowResize),this.registerEventHandler(t.delegate("click",this.onPrevPhotoClick.bind(this),".navigate.prev-photo")),this.registerEventHandler(t.delegate("click",this.onNextPhotoClick.bind(this),".navigate.next-photo")),this.registerEventHandler(t.delegate("click",this.onPhotoClick.bind(this),".preview-photo")),this.registerEventHandler(t.delegate("click",this.onFaveClick.bind(this),".activity-card-fave")),this.registerEventHandler(t.delegate("click",this.onShareClick.bind(this),".activity-card-share:not(.sharing-disabled)")),this.registerEventHandler(t.delegate("click",this.onCommentClick.bind(this),".activity-card-comment")),this.registerEventHandler(t.delegate("click",this.clickComment.bind(this),".comment-count")),this.registerEventHandler(t.delegate("click",this.dontClosePopup.bind(this),".video-js, .preview-content *, .inappropriate-cover")),this.registerEventHandler(t.delegate("click",function(e){e.preventDefault()},".vjs-control-bar")),this.attachKeyEvent("down:37,75,39,74",this.handlePrevNextKeys.bind(this)),this.attachKeyEvent("down:70",this.onFaveClick.bind(this)),this.attachKeyEvent("down:67",this.onCommentClick.bind(this)),this.attachKeyEvent("down:13",function(e){e.stopPropagation(),e.preventDefault()}),this.initVideo(),n.getValue("count")>r.length&&this.fetchBatchPhotos.call(this),this.registerEventHandler(e.on("preview:rebuildCard",this.rebuildCard.bind(this))),i.addClass("animated"),this},dismissOverlayTimeout:function(){var e=this.get("container");this.overlayTimeout&&clearTimeout(this.overlayTimeout),this.overlayTimeout=setTimeout(function(){var t=e.one(".preview-content");t&&t.addClass("hide-overlays")}.bind(this),1e3)},clickComment:function(
e){var t=e.target.ancestor(".feed-card-actions",!0).one(".activity-card-comment");t&&t.getDOMNode().click()},loadImage:function(e,t){var n=new Image,r=(new Date).getTime(),i;return t&&(i=function(){t(n,(new Date).getTime()-r)},n.onload=function(){n.onloadFired||i()}),n.src=e,i&&n.complete&&(n.onloadFired=!0,i()),n},setCurrentPhoto:function(e){var t=this.get("photosList"),n=this.get("currentPhotoIndex");if(e)if(e==="prev"&&n>0)n--,this.set("currentPhotoIndex",n);else{if(!(e==="next"&&n<t.length-1))return;n++,this.set("currentPhotoIndex",n)}n>-1&&n<t.length&&this.set("currentPhoto",t[n])},fetchBatchPhotos:function(t){var r=this.get("activity"),i=this.appContext,s=this;if(!this.isFetching)return s.isFetching=!0,e.Promise.all([i.callAPI("flickr.activity.getBatchPhotos",this.batchApiParams,!0),i.getModelRegistry("photo-models"),i.getModelRegistry("person-models"),i.getModelRegistry("photo-engagement-models"),i.getModelRegistry("photo-stats-models")]).then(function(n){var i=n[0].photos,o=n[1],u=n[2],a=n[3],f=n[4],l=i.photo,c=e.APIHelper.response.parsePhotos({photos:l,ownerID:r.getValue("ownerId"),personModelRegistry:u,photoModelRegistry:o,photoEngagementModelRegistry:a,photoStatsModelRegistry:f});return r.getValue("photos").addPage({page:i.page,perPage:i.perpage,pageContent:c,totalItems:i.total,totalPages:i.pages}),s.totalPages=i.pages,r.getValue("photos").getPage(s.batchApiParams).then(function(e){return s.onBatchPhotosFetched(s.batchApiParams,e),s.isFetching=!1,s.batchApiParams.page++,t&&s.onNextPhotoClick.call(s,!1),e})},function(e){n.log(e)})},onBatchPhotosFetched:function(e,t){var n=this.get("photosList");e.page===1?this.set("photosList",t):this.set("photosList",n.concat(t))},toggleWindowResizeHandler:function(t){var n=document.fullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.msFullscreenElement;n||(this.windowResize=e.globalEvents.subscribe("window:resize",this.onWindowResize.bind(this)),this.registerEventHandler(this.windowResize))},onFullscreenButtonClick:function(e){e.preventDefault(),this.get("container").one(".video-js").hasClass("vjs-fullscreen")||this.windowResize.detach()},onWindowResize:function(e){this.resizePhoto()},resizePhoto:function(){var e=this.appContext.viewportData.getWidth(),t=this.appContext.viewportData.getHeight();if(e<800||t<500||this.get("currentPhoto").getValue("isVideo"))return;this.width=e,this.height=t,this.width<700?this.prevAndNextWidth=50:this.prevAndNextWidth=80,this.navigate()},onPhotoClick:function(t){t.stopPropagation();if(this.get("currentPhoto").getValue("isVideo")){t.preventDefault();return}var n=e.one(".fluid-modal-overlay");n&&n.addClass("is-navigating")},onVideoClick:function(e){e.target.ancestor(".vjs-control-bar")||e.stopPropagation()},onInappropriateCoverClick:function(e){e.stopPropagation()},initVideo:function(){var t=this.get("currentPhoto"),n=this.get("container"),r=this;t.getValue("isVideo")&&e.one("#video_1")&&(this.player=new e.FlickrVideoPlayer({container:n.one(".videoplayer"),model:t,inactivityTimeout:0,appContext:this.appContext,videoNode:e.one("#video_1")._node}),this.player.init().then(function(){r.player.play()}),this.on("destroy",function(){r.player&&(r.player.destroy(),r.player=null)}))},handlePrevNextKeys:function(t){if(this.inShare)return;if(t.button===37||t.button===75)this.onPrevPhotoClick(),e.rapidTracker.beacon(this.name,"prevFeedOverlayKeyPress");else if(t.button===39||t.button===74)this.onNextPhotoClick(),e.rapidTracker.beacon(this.name,"nextFeedOverlayKeyPress")},getNextPhoto:function(){var e=this.get("photosList"),t=this.get("currentPhotoIndex"),n=!1;return t+1<=e.length&&e[t+1]&&(n=e[t+1]),n},getPrevPhoto:function(){var e=this.get("photosList"),t=this.get("currentPhotoIndex"),n=!1;return t-1>-1&&e[t-1]&&(n=e[t-1]),n},dontClosePopup:function(e){e.stopPropagation()},onNextPhotoClick:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=this.getNextPhoto();if(t)this.setCurrentPhoto("next"),this.navigate();else{var n=this.get("currentPhotoIndex")+1;n>=this.get("activity").getValue("photos").getList().length&&n<this.get("activity").getValue("count")&&!this.isFetching&&(this.fetchBatchPhotos.call(this,!0),this.isLoading())}},isLoading:function(){this.setContainerHTML()},navigate:function(){this.urlDisplayedOnFeed=!1,this.params.photoId=this.get("currentPhoto").getValue("id"),this.buildContainer(!0)},onPrevPhotoClick:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=this.getPrevPhoto();t&&(this.setCurrentPhoto("prev"),this.navigate())},getCanvasDimensions:function(){var e=this.prevAndNextWidth,t=140;return{width:this.width-e*2,height:this.height-t}},onFaveClick:function(t){var n=this.get("currentPhoto"),r,i,s="activity-card-fave",o;t.stopPropagation();if(!n)return;r=n.getValue("engagement"),i=!!r.getValue("canFave"),o=r.getValue("faveCount"),i&&(r.registry.toggleFave(n.id),r.registry.remoteUpdate(n.id).then(function(){e.fire("feed:rebuildCard",this.activityId),e.fire("preview:rebuildCard",this.activityId,!0)}.bind(this)))},onShareClick:function(t){var n=this.get("currentPhoto"),r=this;t.stopPropagation();if(!n)return;this.inShare=!0;var i=new e.Views["fluid-share-photo-view"]({appContext:this.appContext,photoId:n.id,nsid:n.getValue("owner").nsid,removeOverlayOnClose:!0});i.on("sharePresentationClose",i.destroy.bind(i)),i.initialize().then(function(n){this.prepareModal(t.target).then(function(t){var i=e.one(".fluid-modal-overlay");i.addClass("over-modal").addClass("more-opaque"),t.get("container").addClass("over-modal"),e.one(".preview-overlay-view").addClass("under-modal"),r.get("container").addClass("under-modal");var s=function(t){r.inShare=!1,i.removeClass("over-modal").removeClass("more-opaque"),i.addClass("animated").addClass("light-overlay"),r.get("container").removeClass("under-modal"),e.one(".preview-overlay-view").removeClass("under-modal")};i.once("click",n.close),n.on("destroy",function(){setTimeout(s,10)})})}.bind
(i)).catch(function(e){}.bind(this))},onCommentClick:function(t){var n=this,r,i,s=this.get("container").one(".activity-card-comment"),o;t.stopPropagation(),r=this.get("currentPhoto"),o=new e.Views["sub-photo-comments-view"]({appContext:this.appContext,photoId:r.id,focusInputOnActivate:!0,viewMoreLinkToPhotoPage:!0,initiallyShowingMaximum:3,fireEventWhenImagesCommentLoaded:!0,isTooltipComments:!0,showCommentButton:!0,textAreaMaxHeight:80}),o.on("commentsImagesLoaded",function(e){i.repositionToElement(s)}),i=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,preferTop:!0,preferLeft:!0,width:480,newReposition:!0,autoSizeToContent:!0,anchorOffsetHorizontal:-10,classList:"feed-photo-comments over-modal",overlayClassList:"over-modal",anchorElement:s,subview:o}),i.on("newCommentAdded",function(t){i.repositionToElement(s),e.fire("feed:rebuildCard",n.activityId),e.fire("preview:rebuildCard",n.activityId)}),i.on("activated",function(e){var n=this.get("container").one(".preview-content");n&&n.addClass("force-overlays"),i.repositionToElement(t.target)}.bind(this)),i.on("destroy",function(e){var t=this.get("container").one(".preview-content");t&&t.removeClass("force-overlays")}.bind(this)),i.show()},destructor:function(){this.overlayTimeout&&clearTimeout(this.overlayTimeout),this.resetRapid()},setRapid:function(t){YUI.Env.isServer||e.ClientApp.updateRapidTracker({},this)},resetRapid:function(){YUI.Env.isServer||e.ClientApp.updateRapidTracker({},this.appContext.flapp.get("activeView"))},rebuildCard:function(t){var n=e.one(".feed-card-actions.on-preview");if(n){var r,i=this.get("currentPhoto");r=this.templates("feed-card-engagement-actions")({suppressCounts:!1,favesCount:i.getValue("engagement").getValue("faveCount"),commentsCount:i.getValue("engagement").getValue("commentCount"),viewsCount:i.getValue("engagement").getValue("viewCount"),photo:i.toJSON(),id:t}),n.setHTML(r)}}},{ATTRS:{spaceid:{value:792600631}}})},"@VERSION@",{requires:["flickr-view","feed-card-engagement-view","sub-photo-comments-view","fluid-droparound-view","hermes-template-preview-photo","hermes-template-adult-content-overlay","hermes-template-feed-card-engagement-actions","hermes-template-feed-card-attribution","flickr-video-player","activity-models","seo","page-title-helper"],langBundles:["preview-overlay","common","feed","fave-view","comments","share-modal","relative-dates","adult-content-overlay"]});
YUI.add("hermes-lang-preview-overlay",function(e,t){e.Intl.add("hermes/preview-overlay","en-US",{VIEW_PHOTO_PAGE:["View photo page"],PAGINATION:["${index}"," / ","${total}"]})},"@VERSION@",{requires:["intl"]});
YUI.add("preview-overlay-view",function(e,t){"use strict";var n=require("lib/flog")(t),r,i;r={css:{destinationContainer:"body",closeX:".close-preview",subviewContent:".content.subview",modalContent:".body .content"},options:{}},i={supportsTransform:!1,modal:{height:0,width:0}},e.namespace("Views").PreviewOverlay=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.set("isActiveViewAgnostic",!0);var n=this.get("modalOverlayType");return n.keyHandler=function(t){t.keyCode===27&&!e.one(".vjs-fullscreen")&&n.clickHandler()},this.changeURL=typeof t.changeURL!="undefined"?t.changeURL:!0,this.baseURL=t.baseURL,this.set("width",this.appContext.viewportData.getWidth()),this.set("height",this.appContext.viewportData.getHeight()),t.activityId&&(e.DeferImages&&e.DeferImages.pause(),this.set("subview",new e.Views["preview-activity-view"]({width:this.get("width"),height:this.get("height"),photoId:t.photoId,urlDisplayedOnFeed:t.urlDisplayedOnFeed,previewSpaceId:t.previewSpaceId,growTextFieldWhenTyping:!1,photoModel:t.photoModel,activityId:t.activityId,safeSearch:t.safeSearch}))),this.alreadyShowingModal=n.alreadyShowingModal(),this.alreadyShowingModal||n.add(this),this},buildContainer:function(){if(!this.alreadyShowingModal){var t=this,s=e.one(r.css.destinationContainer),o;o={noScroll:this.get("noScroll"),subview:!!this.get("subview"),hideModalOverlay:this.get("hideModalOverlay"),classList:this.get("classList")},this.setContainerWithTemplate("preview-overlay",o),i.modal.width=this.get("width"),i.modal.minWidth=this.get("minWidth"),i.modal.height=this.get("height"),this.get("subview")?(this.get("subview").appContext=t.appContext,this.get("subview").set("isActiveViewAgnostic",!0),this.get("subview").initialize().then(function(e){e.on("parentViewEvent",function(t){t&&t.details&&t.details.length&&e.fire.apply(e,["parentViewEvent"].concat(t.details))}),t.get("container").one(r.css.subviewContent).appendChild(e.get("container")),s&&(s.append(t.get("container")),t.reposition()),t.activate()},function(e){n.error("Error initializing modal subview",{err:e})})):s&&(s.append(this.get("container")),this.reposition())}return this},activate:function(){var t=this.get("container"),n=this;return this.registerEventHandler(t.one(r.css.closeX).on("click",e.bind(this.close,this))),this.registerEventHandler(this.appContext.flapp.on("activeViewChange",function(e){n.close(e,!0)})),this.registerEventHandler(e.globalEvents.subscribe("window:resize",function(e){n.reposition()})),this.registerEventHandler(t.on("click",function(e){n.close(e)})),this.get("subview")&&n.get("subview").activate(),this.fire("activated"),this},show:function(){return this.initialize().then(null,function(e){n.error("Error initializing modal",{err:e})}),this.isClosed=!1,this.freeze(),e.fire("flickr:setKeyEventScope",this.getKeyEventScope()),this},freeze:function(){e.one("body").setStyles({overflow:"hidden"})},unfreeze:function(){e.one("body").setStyles({overflow:"visible"})},reposition:function(){},close:function(t,n){e.fire("flickr:removeKeyEventScope",this.getKeyEventScope());var r=this.get("container");this.isClosed=!0,e.one("body").removeClass("scroll-fluid-modal"),this.get("subview")&&this.get("subview").destroy(),r&&r.remove(!0),this.fire("close",t),this.destroy(),this.get("modalOverlayType").remove(this),n||e.config.win.history.replaceState({},"",this.baseURL),e.DeferImages&&e.DeferImages.resume(),document&&(document.title=e.pageTitleHelper(this.intlMessage({intlName:"common.HOME"})))},getKeyEventScope:function(){return this.name+this._yuid},destructor:function(){this.unfreeze(),this.detachAll()}},{ATTRS:{showCancelX:{value:!0},hideModalOverlay:{value:!1},lightOverlay:{value:!0},dismissOnOverlayClick:{value:!0},title:{value:""},width:{value:0},minWidth:{value:0},height:{value:0},subview:{value:null},classList:{value:""},maxHeight:{value:!0},modalSelector:{value:".modal"},modalOverlayType:{value:e.OverlayManager.ModalOverlay}}})},"@VERSION@",{requires:["flickr-view","hermes-template-preview-overlay","fluid-overlay-manager-view","preview-activity-view","page-title-helper"],langBundles:["common","preview-overlay"]});
YUI.add("flickr-account-addEmail-updater",function(e,t){"use strict";function n(n,r){var i=n;return r.callAPI("flickr.account.addEmail",i).then(function(e){return e},e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-account-addEmail"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:["account-email-model"]});
YUI.add("account-email-model",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-account-getEmails"].run(t,this.appContext).then(function(e){return e})},updateEmail:function(t,n){return e.ModelUpdaters["flickr-account-addEmail"].run(t,n)}},remoteUpdateEmail:function(e,t,n){var r=this.getValue(e,"emails"),i={date_create:Date.now(),email:t.email,email_conf:"0",date_email_conf:"0",is_primary:"0"};return r.push(i),this.setValue(e,"emails",r),this.remote.updateEmail(t,n)},attributes:{id:{setter:function(e){return e||this.appContext.getViewer().nsid}},account:{},emails:[]}})},"@VERSION@",{requires:["flickr-model-registry","flickr-account-getEmails-fetcher","flickr-account-addEmail-updater"]});
YUI.add("flickr-account-getEmails-fetcher",function(e,t){"use strict";function n(e,t,n){var r=e.apiResponse,i=e.emailModelRegistry,s={id:r.account.id,account:r.account,emails:r.emails};return i.addOrUpdate(s),r}function r(n,r){var i=this,s=n;return(new e.FlickrPromise({apiResponse:r.callAPI("flickr.account.getEmails",s),emailModelRegistry:r.getModelRegistry("account-email-model")})).then(function(e){return i._processResponse(e,s,r)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-account-getEmails"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"],optional:["account-email-model"]});
YUI.add("hermes-template-fluid-share",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return" disable-sharing"},3:function(e,t,n,r,i){return' title="'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"share-modal.SHARING_DISABLED"},data:i}))+'" '},5:function(e,t,n,r,i){var s;return' title="'+e.escapeExpression((s=(s=n.shareTooltip||(t!=null?t.shareTooltip:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"shareTooltip",hash:{},data:i}):s))+'"'},7:function(e,t,n,r,i){var s,o=t!=null?t:{};return"		<span "+((s=n["if"].call(o,t!=null?t.sharingDisabled:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.program(5,i,0),data:i}))!=null?s:"")+' class="fluid-share-button-label">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:"share-modal.SHARE"},data:i}))+"</span>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'<div class="fluid-share-button '+l((o=(o=n.extraShareButtonClassList||(t!=null?t.extraShareButtonClassList:t))!=null?o:a,typeof o===f?o.call(u,{name:"extraShareButtonClassList",hash:{},data:i}):o))+((s=n["if"].call(u,t!=null?t.sharingDisabled:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+'"\n'+((s=n["if"].call(u,t!=null?t.sharingDisabled:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.program(5,i,0),data:i}))!=null?s:"")+' tabindex="0">\n\n	<span '+((s=n["if"].call(u,t!=null?t.sharingDisabled:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.program(5,i,0),data:i}))!=null?s:"")+' class="fluid-share-icon '+l((o=(o=n.extraShareButtonIconClassList||(t!=null?t.extraShareButtonIconClassList:t))!=null?o:a,typeof o===f?o.call(u,{name:"extraShareButtonIconClassList",hash:{},data:i}):o))+'"></span>\n'+((s=n["if"].call(u,t!=null?t.showShareButtonLabel:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n </div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-share",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-fluid-share-tumblr-post",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return"	<strong>"+f((s=(s=n.title||(t!=null?t.title:t))!=null?s:u,typeof s===a?s.call(o,{name:"title",hash:{},data:i}):s))+' <a href="'+f((s=(s=n.ownerURL||(t!=null?t.ownerURL:t))!=null?s:u,typeof s===a?s.call(o,{name:"ownerURL",hash:{},data:i}):s))+'">'+f((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{user:t!=null?t.ownerName:t,intlName:"common.BY_USER"},data:i}))+"</a></strong>\n"},3:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.ownerURL:t,{name:"if",hash:{},fn:e.program(4,i,0),inverse:e.program(6,i,0),data:i}))!=null?s:""},4:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'		<strong><a href="'+f((s=(s=n.ownerURL||(t!=null?t.ownerURL:t))!=null?s:u,typeof s===a?s.call(o,{name:"ownerURL",hash:{},data:i}):s))+'">'+f((s=(s=n.title||(t!=null?t.title:t))!=null?s:u,typeof s===a?s.call(o,{name:"title",hash:{},data:i}):s))+"</a></strong>\n"},6:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'		<strong><a href="'+f((s=(s=n.linkToShare||(t!=null?t.linkToShare:t))!=null?s:u,typeof s===a?s.call(o,{name:"linkToShare",hash:{},data:i}):s))+'">'+f((s=(s=n.title||(t!=null?t.title:t))!=null?s:u,typeof s===a?s.call(o,{name:"title",hash:{},data:i}):s))+"</a></strong>\n"},8:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return"	<br /><i>"+u((n.intlMessage||t&&t.intlMessage||o).call(s,{name:"intlMessage",hash:{intlName:"share-modal.VIA_FLICKR"},data:i}))+"</i>\n	<br />"+u((n.renderTrustedMarkup||t&&t.renderTrustedMarkup||o).call(s,t!=null?t.description:t,{name:"renderTrustedMarkup",hash:{},data:i}))+"\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return((s=n["if"].call(o,t!=null?t.ownerName:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+"\n"+((s=n["if"].call(o,t!=null?t.description:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.noop,data:i}))!=null?s:"")},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-share-tumblr-post",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
